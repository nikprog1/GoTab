/**
 * –°–∫—Ä–∏–ø—Ç –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ª–∏—Å—Ç–∞ "–í—Å–µ" –ø–æ –º–µ—Å—è—Ü–∞–º
 * –ö–∞–∂–¥—ã–π –º–µ—Å—è—Ü –ø–æ–ª—É—á–∞–µ—Ç —Å–≤–æ–π —Ü–≤–µ—Ç —Ñ–æ–Ω–∞ –¥–ª—è –≤—Å–µ—Ö —Å—Ç—Ä–æ–∫
 */

// ============================================================================
// –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø
// ============================================================================
var –ö–û–ù–§–ò–ì_–§–û–†–ú–ê–¢–ò–†–û–í–ê–ù–ò–Ø = {
  // –ò–º—è –ª–∏—Å—Ç–∞ –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
  –õ–ò–°–¢_–î–ê–ù–ù–´–•: '–í—Å–µ',
  
  // –ö–æ–ª–æ–Ω–∫–∞ —Å –¥–∞—Ç–æ–π (B = 2)
  –ö–û–õ–û–ù–ö–ê_–î–ê–¢–´: 2,
  
  // –ü–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö (1 = –∑–∞–≥–æ–ª–æ–≤–∫–∏, 2 = –¥–∞–Ω–Ω—ã–µ)
  –ü–ï–†–í–ê–Ø_–°–¢–†–û–ö–ê_–î–ê–ù–ù–´–•: 2,
  
  // –¶–≤–µ—Ç–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–µ—Å—è—Ü–∞ (12 —Ü–≤–µ—Ç–æ–≤)
  –¶–í–ï–¢–ê_–ú–ï–°–Ø–¶–ï–í: [
    '#E8F4F8',  // –Ø–Ω–≤–∞—Ä—å - —Å–≤–µ—Ç–ª–æ-–≥–æ–ª—É–±–æ–π
    '#FFF2CC',  // –§–µ–≤—Ä–∞–ª—å - —Å–≤–µ—Ç–ª–æ-–∂–µ–ª—Ç—ã–π
    '#E2EFDA',  // –ú–∞—Ä—Ç - —Å–≤–µ—Ç–ª–æ-–∑–µ–ª–µ–Ω—ã–π
    '#F4B084',  // –ê–ø—Ä–µ–ª—å - —Å–≤–µ—Ç–ª–æ-–æ—Ä–∞–Ω–∂–µ–≤—ã–π
    '#D5E8D4',  // –ú–∞–π - —Å–≤–µ—Ç–ª–æ-—Å–∞–ª–∞—Ç–æ–≤—ã–π
    '#F8CECC',  // –ò—é–Ω—å - —Å–≤–µ—Ç–ª–æ-—Ä–æ–∑–æ–≤—ã–π
    '#DEEBF7',  // –ò—é–ª—å - —Å–≤–µ—Ç–ª–æ-—Å–∏–Ω–∏–π
    '#FFE699',  // –ê–≤–≥—É—Å—Ç - –∂–µ–ª—Ç—ã–π
    '#F2F2F2',  // –°–µ–Ω—Ç—è–±—Ä—å - —Å–≤–µ—Ç–ª–æ-—Å–µ—Ä—ã–π
    '#E1D5E7',  // –û–∫—Ç—è–±—Ä—å - —Å–≤–µ—Ç–ª–æ-—Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π
    '#D0CECE',  // –ù–æ—è–±—Ä—å - —Å–µ—Ä—ã–π
    '#FCE4D6'   // –î–µ–∫–∞–±—Ä—å - –ø–µ—Ä—Å–∏–∫–æ–≤—ã–π
  ]
};

// ============================================================================
// –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò
// ============================================================================

/**
 * –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ —è—á–µ–π–∫–∏ –≤ –¥–∞—Ç—É
 */
function –ø–æ–ª—É—á–∏—Ç—å–î–∞—Ç—É–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ(–∑–Ω–∞—á–µ–Ω–∏–µ) {
  if (!–∑–Ω–∞—á–µ–Ω–∏–µ) return null;
  
  // –ï—Å–ª–∏ —ç—Ç–æ —É–∂–µ –æ–±—ä–µ–∫—Ç Date
  if (–∑–Ω–∞—á–µ–Ω–∏–µ instanceof Date) {
    return –∑–Ω–∞—á–µ–Ω–∏–µ;
  }
  
  // –ï—Å–ª–∏ —ç—Ç–æ —Å—Ç—Ä–æ–∫–∞, –ø—ã—Ç–∞–µ–º—Å—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å
  if (typeof –∑–Ω–∞—á–µ–Ω–∏–µ === 'string') {
    // –§–æ—Ä–º–∞—Ç DD.MM.YYYY
    var —á–∞—Å—Ç–∏ = –∑–Ω–∞—á–µ–Ω–∏–µ.split('.');
    if (—á–∞—Å—Ç–∏.length === 3) {
      var –¥–µ–Ω—å = parseInt(—á–∞—Å—Ç–∏[0], 10);
      var –º–µ—Å—è—Ü = parseInt(—á–∞—Å—Ç–∏[1], 10) - 1; // –º–µ—Å—è—Ü—ã –≤ JS –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å 0
      var –≥–æ–¥ = parseInt(—á–∞—Å—Ç–∏[2], 10);
      var –¥–∞—Ç–∞ = new Date(–≥–æ–¥, –º–µ—Å—è—Ü, –¥–µ–Ω—å);
      if (!isNaN(–¥–∞—Ç–∞.getTime())) {
        return –¥–∞—Ç–∞;
      }
    }
    // –ü—Ä–æ–±—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ
    var –¥–∞—Ç–∞ = new Date(–∑–Ω–∞—á–µ–Ω–∏–µ);
    if (!isNaN(–¥–∞—Ç–∞.getTime())) {
      return –¥–∞—Ç–∞;
    }
  }
  
  return null;
}

/**
 * –ü–æ–ª—É—á–∞–µ—Ç –Ω–æ–º–µ—Ä –º–µ—Å—è—Ü–∞ –∏–∑ –¥–∞—Ç—ã (0-11)
 */
function –ø–æ–ª—É—á–∏—Ç—å–ù–æ–º–µ—Ä–ú–µ—Å—è—Ü–∞(–¥–∞—Ç–∞) {
  if (!–¥–∞—Ç–∞) {
    return null;
  }
  
  if (!(–¥–∞—Ç–∞ instanceof Date)) {
    Logger.log('–î–∞—Ç–∞ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –æ–±—ä–µ–∫—Ç–æ–º Date: ' + typeof –¥–∞—Ç–∞);
    return null;
  }
  
  if (isNaN(–¥–∞—Ç–∞.getTime())) {
    Logger.log('–ù–µ–≤–∞–ª–∏–¥–Ω–∞—è –¥–∞—Ç–∞: ' + –¥–∞—Ç–∞);
    return null;
  }
  
  var –º–µ—Å—è—Ü = –¥–∞—Ç–∞.getMonth(); // 0 = —è–Ω–≤–∞—Ä—å, 11 = –¥–µ–∫–∞–±—Ä—å
  return –º–µ—Å—è—Ü;
}

/**
 * –ü–æ–ª—É—á–∞–µ—Ç —Ü–≤–µ—Ç –¥–ª—è –º–µ—Å—è—Ü–∞ –ø–æ –µ–≥–æ –Ω–æ–º–µ—Ä—É (0-11)
 */
function –ø–æ–ª—É—á–∏—Ç—å–¶–≤–µ—Ç–ú–µ—Å—è—Ü–∞(–Ω–æ–º–µ—Ä–ú–µ—Å—è—Ü–∞) {
  if (–Ω–æ–º–µ—Ä–ú–µ—Å—è—Ü–∞ === null || –Ω–æ–º–µ—Ä–ú–µ—Å—è—Ü–∞ < 0 || –Ω–æ–º–µ—Ä–ú–µ—Å—è—Ü–∞ > 11) {
    return null;
  }
  return –ö–û–ù–§–ò–ì_–§–û–†–ú–ê–¢–ò–†–û–í–ê–ù–ò–Ø.–¶–í–ï–¢–ê_–ú–ï–°–Ø–¶–ï–í[–Ω–æ–º–µ—Ä–ú–µ—Å—è—Ü–∞];
}

/**
 * –ü–æ–ª—É—á–∞–µ—Ç –ª–∏—Å—Ç –ø–æ –∏–º–µ–Ω–∏ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
 */
function –ø–æ–ª—É—á–∏—Ç—å–õ–∏—Å—Ç(spreadsheet, –∏–º—è–õ–∏—Å—Ç–∞) {
  var –ª–∏—Å—Ç = spreadsheet.getSheetByName(–∏–º—è–õ–∏—Å—Ç–∞);
  if (!–ª–∏—Å—Ç) {
    var –æ—à–∏–±–∫–∞ = '–õ–∏—Å—Ç "' + –∏–º—è–õ–∏—Å—Ç–∞ + '" –Ω–µ –Ω–∞–π–¥–µ–Ω!';
    Logger.log('–û–®–ò–ë–ö–ê: ' + –æ—à–∏–±–∫–∞);
    throw new Error(–æ—à–∏–±–∫–∞);
  }
  return –ª–∏—Å—Ç;
}

/**
 * –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ª–∏—Å—Ç–∞ "–í—Å–µ" –ø–æ –º–µ—Å—è—Ü–∞–º
 */
function Format_Income() {
  try {
    Logger.log('=== –ù–∞—á–∞–ª–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ª–∏—Å—Ç–∞ "–í—Å–µ" ===');
    
    var spreadsheet = SpreadsheetApp.getActiveSpreadsheet();
    
    // –ü–æ–ª—É—á–∞–µ–º –ª–∏—Å—Ç
    var –ª–∏—Å—Ç;
    try {
      –ª–∏—Å—Ç = –ø–æ–ª—É—á–∏—Ç—å–õ–∏—Å—Ç(spreadsheet, –ö–û–ù–§–ò–ì_–§–û–†–ú–ê–¢–ò–†–û–í–ê–ù–ò–Ø.–õ–ò–°–¢_–î–ê–ù–ù–´–•);
    } catch (error) {
      Logger.log('–û–®–ò–ë–ö–ê: ' + error.message);
      spreadsheet.toast(error.message, '–û—à–∏–±–∫–∞', 5);
      return;
    }
    
    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é —Å—Ç—Ä–æ–∫—É —Å –¥–∞–Ω–Ω—ã–º–∏
    var –ø–æ—Å–ª–µ–¥–Ω—è—è–°—Ç—Ä–æ–∫–∞ = –ª–∏—Å—Ç.getLastRow();
    if (–ø–æ—Å–ª–µ–¥–Ω—è—è–°—Ç—Ä–æ–∫–∞ < –ö–û–ù–§–ò–ì_–§–û–†–ú–ê–¢–ò–†–û–í–ê–ù–ò–Ø.–ü–ï–†–í–ê–Ø_–°–¢–†–û–ö–ê_–î–ê–ù–ù–´–•) {
      Logger.log('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è');
      spreadsheet.toast('–ù–∞ –ª–∏—Å—Ç–µ "' + –ö–û–ù–§–ò–ì_–§–û–†–ú–ê–¢–ò–†–û–í–ê–ù–ò–Ø.–õ–ò–°–¢_–î–ê–ù–ù–´–• + '" –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è', '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è', 5);
      return;
    }
    
    Logger.log('–ß—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å –ª–∏—Å—Ç–∞ "' + –ö–û–ù–§–ò–ì_–§–û–†–ú–ê–¢–ò–†–û–í–ê–ù–ò–Ø.–õ–ò–°–¢_–î–ê–ù–ù–´–• + '"...');
    Logger.log('–ü–æ—Å–ª–µ–¥–Ω—è—è —Å—Ç—Ä–æ–∫–∞: ' + –ø–æ—Å–ª–µ–¥–Ω—è—è–°—Ç—Ä–æ–∫–∞);
    
    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–ª–æ–Ω–æ–∫ (–±–µ—Ä–µ–º –∏–∑ –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö)
    var –ø–æ—Å–ª–µ–¥–Ω—è—è–ö–æ–ª–æ–Ω–∫–∞ = –ª–∏—Å—Ç.getLastColumn();
    Logger.log('–ü–æ—Å–ª–µ–¥–Ω—è—è –∫–æ–ª–æ–Ω–∫–∞: ' + –ø–æ—Å–ª–µ–¥–Ω—è—è–ö–æ–ª–æ–Ω–∫–∞);
    
    // –ß–∏—Ç–∞–µ–º –≤—Å–µ –¥–∞—Ç—ã –æ–¥–Ω–∏–º –±–∞—Ç—á–µ–º –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
    var –¥–∏–∞–ø–∞–∑–æ–Ω–î–∞—Ç = –ª–∏—Å—Ç.getRange(
      –ö–û–ù–§–ò–ì_–§–û–†–ú–ê–¢–ò–†–û–í–ê–ù–ò–Ø.–ü–ï–†–í–ê–Ø_–°–¢–†–û–ö–ê_–î–ê–ù–ù–´–•, 
      –ö–û–ù–§–ò–ì_–§–û–†–ú–ê–¢–ò–†–û–í–ê–ù–ò–Ø.–ö–û–õ–û–ù–ö–ê_–î–ê–¢–´, 
      –ø–æ—Å–ª–µ–¥–Ω—è—è–°—Ç—Ä–æ–∫–∞ - –ö–û–ù–§–ò–ì_–§–û–†–ú–ê–¢–ò–†–û–í–ê–ù–ò–Ø.–ü–ï–†–í–ê–Ø_–°–¢–†–û–ö–ê_–î–ê–ù–ù–´–• + 1, 
      1
    );
    var –∑–Ω–∞—á–µ–Ω–∏—è–î–∞—Ç = –¥–∏–∞–ø–∞–∑–æ–Ω–î–∞—Ç.getValues();
    
    // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º —Å—Ç—Ä–æ–∫–∏ –ø–æ –º–µ—Å—è—Ü–∞–º
    var —Å—Ç—Ä–æ–∫–∏–ü–æ–ú–µ—Å—è—Ü–∞–º = {};
    var –Ω–∞–∑–≤–∞–Ω–∏—è–ú–µ—Å—è—Ü–µ–≤ = [
      '–Ø–Ω–≤–∞—Ä—å', '–§–µ–≤—Ä–∞–ª—å', '–ú–∞—Ä—Ç', '–ê–ø—Ä–µ–ª—å', '–ú–∞–π', '–ò—é–Ω—å',
      '–ò—é–ª—å', '–ê–≤–≥—É—Å—Ç', '–°–µ–Ω—Ç—è–±—Ä—å', '–û–∫—Ç—è–±—Ä—å', '–ù–æ—è–±—Ä—å', '–î–µ–∫–∞–±—Ä—å'
    ];
    
    for (var i = 0; i < –∑–Ω–∞—á–µ–Ω–∏—è–î–∞—Ç.length; i++) {
      var –¥–∞—Ç–∞–ó–Ω–∞—á–µ–Ω–∏–µ = –∑–Ω–∞—á–µ–Ω–∏—è–î–∞—Ç[i][0];
      
      // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—É—Å—Ç—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
      if (!–¥–∞—Ç–∞–ó–Ω–∞—á–µ–Ω–∏–µ || –¥–∞—Ç–∞–ó–Ω–∞—á–µ–Ω–∏–µ === '') {
        continue;
      }
      
      var –¥–∞—Ç–∞ = –ø–æ–ª—É—á–∏—Ç—å–î–∞—Ç—É–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ(–¥–∞—Ç–∞–ó–Ω–∞—á–µ–Ω–∏–µ);
      
      if (!–¥–∞—Ç–∞) {
        Logger.log('–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –¥–∞—Ç—É –≤ —Å—Ç—Ä–æ–∫–µ ' + (–ö–û–ù–§–ò–ì_–§–û–†–ú–ê–¢–ò–†–û–í–ê–ù–ò–Ø.–ü–ï–†–í–ê–Ø_–°–¢–†–û–ö–ê_–î–ê–ù–ù–´–• + i) + ': ' + –¥–∞—Ç–∞–ó–Ω–∞—á–µ–Ω–∏–µ);
        continue;
      }
      
      var –Ω–æ–º–µ—Ä–ú–µ—Å—è—Ü–∞ = –ø–æ–ª—É—á–∏—Ç—å–ù–æ–º–µ—Ä–ú–µ—Å—è—Ü–∞(–¥–∞—Ç–∞);
      if (–Ω–æ–º–µ—Ä–ú–µ—Å—è—Ü–∞ === null) {
        continue;
      }
      
      var –Ω–æ–º–µ—Ä–°—Ç—Ä–æ–∫–∏ = –ö–û–ù–§–ò–ì_–§–û–†–ú–ê–¢–ò–†–û–í–ê–ù–ò–Ø.–ü–ï–†–í–ê–Ø_–°–¢–†–û–ö–ê_–î–ê–ù–ù–´–• + i;
      
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –º–∞—Å—Å–∏–≤ –¥–ª—è –º–µ—Å—è—Ü–∞, –µ—Å–ª–∏ –µ–≥–æ –µ—â–µ –Ω–µ—Ç
      if (!—Å—Ç—Ä–æ–∫–∏–ü–æ–ú–µ—Å—è—Ü–∞–º[–Ω–æ–º–µ—Ä–ú–µ—Å—è—Ü–∞]) {
        —Å—Ç—Ä–æ–∫–∏–ü–æ–ú–µ—Å—è—Ü–∞–º[–Ω–æ–º–µ—Ä–ú–µ—Å—è—Ü–∞] = [];
      }
      
      —Å—Ç—Ä–æ–∫–∏–ü–æ–ú–µ—Å—è—Ü–∞–º[–Ω–æ–º–µ—Ä–ú–µ—Å—è—Ü–∞].push(–Ω–æ–º–µ—Ä–°—Ç—Ä–æ–∫–∏);
    }
    
    Logger.log('–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –ú–µ—Å—è—Ü–µ–≤ –Ω–∞–π–¥–µ–Ω–æ: ' + Object.keys(—Å—Ç—Ä–æ–∫–∏–ü–æ–ú–µ—Å—è—Ü–∞–º).length);
    
    // –õ–æ–≥–∏—Ä—É–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –º–µ—Å—è—Ü–∞–º
    for (var –º–µ—Å—è—Ü in —Å—Ç—Ä–æ–∫–∏–ü–æ–ú–µ—Å—è—Ü–∞–º) {
      Logger.log('–ú–µ—Å—è—Ü ' + –Ω–∞–∑–≤–∞–Ω–∏—è–ú–µ—Å—è—Ü–µ–≤[parseInt(–º–µ—Å—è—Ü)] + ': ' + —Å—Ç—Ä–æ–∫–∏–ü–æ–ú–µ—Å—è—Ü–∞–º[–º–µ—Å—è—Ü].length + ' —Å—Ç—Ä–æ–∫');
    }
    
    // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–µ—Å—è—Ü–∞
    var –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ–°—Ç—Ä–æ–∫ = 0;
    for (var –Ω–æ–º–µ—Ä–ú–µ—Å—è—Ü–∞ in —Å—Ç—Ä–æ–∫–∏–ü–æ–ú–µ—Å—è—Ü–∞–º) {
      var —Å—Ç—Ä–æ–∫–∏–ú–µ—Å—è—Ü–∞ = —Å—Ç—Ä–æ–∫–∏–ü–æ–ú–µ—Å—è—Ü–∞–º[–Ω–æ–º–µ—Ä–ú–µ—Å—è—Ü–∞];
      var —Ü–≤–µ—Ç = –ø–æ–ª—É—á–∏—Ç—å–¶–≤–µ—Ç–ú–µ—Å—è—Ü–∞(parseInt(–Ω–æ–º–µ—Ä–ú–µ—Å—è—Ü–∞));
      
      if (!—Ü–≤–µ—Ç || —Å—Ç—Ä–æ–∫–∏–ú–µ—Å—è—Ü–∞.length === 0) {
        continue;
      }
      
      Logger.log('–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ' + —Å—Ç—Ä–æ–∫–∏–ú–µ—Å—è—Ü–∞.length + ' —Å—Ç—Ä–æ–∫ –¥–ª—è ' + –Ω–∞–∑–≤–∞–Ω–∏—è–ú–µ—Å—è—Ü–µ–≤[parseInt(–Ω–æ–º–µ—Ä–ú–µ—Å—è—Ü–∞)] + ' (—Ü–≤–µ—Ç: ' + —Ü–≤–µ—Ç + ')');
      
      // –°–æ—Ä—Ç–∏—Ä—É–µ–º —Å—Ç—Ä–æ–∫–∏ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏
      —Å—Ç—Ä–æ–∫–∏–ú–µ—Å—è—Ü–∞.sort(function(a, b) { return a - b; });
      
      // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ü–≤–µ—Ç –∫–æ –≤—Å–µ–º —Å—Ç—Ä–æ–∫–∞–º –º–µ—Å—è—Ü–∞
      // –î–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –≥—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏
      var —Ç–µ–∫—É—â–∞—è–ì—Ä—É–ø–ø–∞ = [—Å—Ç—Ä–æ–∫–∏–ú–µ—Å—è—Ü–∞[0]];
      var –Ω–∞—á–∞–ª–æ–ì—Ä—É–ø–ø—ã = —Å—Ç—Ä–æ–∫–∏–ú–µ—Å—è—Ü–∞[0];
      
      for (var j = 1; j < —Å—Ç—Ä–æ–∫–∏–ú–µ—Å—è—Ü–∞.length; j++) {
        var —Ç–µ–∫—É—â–∞—è–°—Ç—Ä–æ–∫–∞ = —Å—Ç—Ä–æ–∫–∏–ú–µ—Å—è—Ü–∞[j];
        var –ø—Ä–µ–¥—ã–¥—É—â–∞—è–°—Ç—Ä–æ–∫–∞ = —Å—Ç—Ä–æ–∫–∏–ú–µ—Å—è—Ü–∞[j - 1];
        
        // –ï—Å–ª–∏ —Å—Ç—Ä–æ–∫–∏ –∏–¥—É—Ç –ø–æ–¥—Ä—è–¥, –¥–æ–±–∞–≤–ª—è–µ–º –≤ –≥—Ä—É–ø–ø—É
        if (—Ç–µ–∫—É—â–∞—è–°—Ç—Ä–æ–∫–∞ === –ø—Ä–µ–¥—ã–¥—É—â–∞—è–°—Ç—Ä–æ–∫–∞ + 1) {
          —Ç–µ–∫—É—â–∞—è–ì—Ä—É–ø–ø–∞.push(—Ç–µ–∫—É—â–∞—è–°—Ç—Ä–æ–∫–∞);
        } else {
          // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫ –≥—Ä—É–ø–ø–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Å—Ç—Ä–æ–∫
          if (—Ç–µ–∫—É—â–∞—è–ì—Ä—É–ø–ø–∞.length > 0) {
            var –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–°—Ç—Ä–æ–∫ = —Ç–µ–∫—É—â–∞—è–ì—Ä—É–ø–ø–∞.length;
            var –¥–∏–∞–ø–∞–∑–æ–Ω = –ª–∏—Å—Ç.getRange(–Ω–∞—á–∞–ª–æ–ì—Ä—É–ø–ø—ã, 1, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–°—Ç—Ä–æ–∫, –ø–æ—Å–ª–µ–¥–Ω—è—è–ö–æ–ª–æ–Ω–∫–∞);
            –¥–∏–∞–ø–∞–∑–æ–Ω.setBackground(—Ü–≤–µ—Ç);
            Logger.log('–ü—Ä–∏–º–µ–Ω–µ–Ω —Ü–≤–µ—Ç ' + —Ü–≤–µ—Ç + ' –∫ —Å—Ç—Ä–æ–∫–∞–º ' + –Ω–∞—á–∞–ª–æ–ì—Ä—É–ø–ø—ã + '-' + (–Ω–∞—á–∞–ª–æ–ì—Ä—É–ø–ø—ã + –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–°—Ç—Ä–æ–∫ - 1));
            –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ–°—Ç—Ä–æ–∫ += –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–°—Ç—Ä–æ–∫;
          }
          
          // –ù–∞—á–∏–Ω–∞–µ–º –Ω–æ–≤—É—é –≥—Ä—É–ø–ø—É
          —Ç–µ–∫—É—â–∞—è–ì—Ä—É–ø–ø–∞ = [—Ç–µ–∫—É—â–∞—è–°—Ç—Ä–æ–∫–∞];
          –Ω–∞—á–∞–ª–æ–ì—Ä—É–ø–ø—ã = —Ç–µ–∫—É—â–∞—è–°—Ç—Ä–æ–∫–∞;
        }
      }
      
      // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≥—Ä—É–ø–ø–µ
      if (—Ç–µ–∫—É—â–∞—è–ì—Ä—É–ø–ø–∞.length > 0) {
        var –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–°—Ç—Ä–æ–∫ = —Ç–µ–∫—É—â–∞—è–ì—Ä—É–ø–ø–∞.length;
        var –¥–∏–∞–ø–∞–∑–æ–Ω = –ª–∏—Å—Ç.getRange(–Ω–∞—á–∞–ª–æ–ì—Ä—É–ø–ø—ã, 1, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–°—Ç—Ä–æ–∫, –ø–æ—Å–ª–µ–¥–Ω—è—è–ö–æ–ª–æ–Ω–∫–∞);
        –¥–∏–∞–ø–∞–∑–æ–Ω.setBackground(—Ü–≤–µ—Ç);
        Logger.log('–ü—Ä–∏–º–µ–Ω–µ–Ω —Ü–≤–µ—Ç ' + —Ü–≤–µ—Ç + ' –∫ —Å—Ç—Ä–æ–∫–∞–º ' + –Ω–∞—á–∞–ª–æ–ì—Ä—É–ø–ø—ã + '-' + (–Ω–∞—á–∞–ª–æ–ì—Ä—É–ø–ø—ã + –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–°—Ç—Ä–æ–∫ - 1));
        –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ–°—Ç—Ä–æ–∫ += –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–°—Ç—Ä–æ–∫;
      }
    }
    
    Logger.log('=== –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ ===');
    Logger.log('–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ —Å—Ç—Ä–æ–∫: ' + –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ–°—Ç—Ä–æ–∫);
    
    var —Å–æ–æ–±—â–µ–Ω–∏–µ = '–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ! –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ —Å—Ç—Ä–æ–∫: ' + –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ–°—Ç—Ä–æ–∫ + ', –º–µ—Å—è—Ü–µ–≤: ' + Object.keys(—Å—Ç—Ä–æ–∫–∏–ü–æ–ú–µ—Å—è—Ü–∞–º).length;
    spreadsheet.toast(—Å–æ–æ–±—â–µ–Ω–∏–µ, '–ì–æ—Ç–æ–≤–æ', 5);
    
  } catch (error) {
    var —Å–æ–æ–±—â–µ–Ω–∏–µ = '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏: ' + error.toString();
    Logger.log('–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: ' + —Å–æ–æ–±—â–µ–Ω–∏–µ);
    Logger.log('–°—Ç–µ–∫ –≤—ã–∑–æ–≤–æ–≤: ' + error.stack);
    try {
      SpreadsheetApp.getActiveSpreadsheet().toast(—Å–æ–æ–±—â–µ–Ω–∏–µ, '–û—à–∏–±–∫–∞', 10);
    } catch (e) {
      // –ï—Å–ª–∏ toast —Ç–æ–∂–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø—Ä–æ—Å—Ç–æ –ª–æ–≥–∏—Ä—É–µ–º
      Logger.log('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é: ' + e.toString());
    }
    throw error;
  }
}

/**
 * –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –º–µ–Ω—é –≤ Google Sheets
 */
function onOpen() {
  var ui = SpreadsheetApp.getUi();
  ui.createMenu('üìä –§–∏–Ω–∞–Ω—Å—ã')
    .addItem('–°—É–º–º–∏—Ä–æ–≤–∞—Ç—å –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º', 'Test')
    .addSeparator()
    .addItem('–§–æ—Ä–º–∞—Ç –í–°–ï', 'Format_Income')
    .addToUi();
}
