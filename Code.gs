/**
 * –°–∫—Ä–∏–ø—Ç –¥–ª—è —Å—É–º–º–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
 * –°—á–∏—Ç—ã–≤–∞–µ—Ç –¥–∏–∞–ø–∞–∑–æ–Ω –¥–∞—Ç —Å –ª–∏—Å—Ç–∞ "AI" –∏ —Å—É–º–º–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ —Å –ª–∏—Å—Ç–∞ "–í—Å–µ"
 */

// ============================================================================
// –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø (–£–ª—É—á—à–µ–Ω–∏–µ #3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–ª–æ–Ω–æ–∫ —á–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é)
// ============================================================================
var –ö–û–ù–§–ò–ì = {
  // –ò–º–µ–Ω–∞ –ª–∏—Å—Ç–æ–≤
  –õ–ò–°–¢_–†–ï–ó–£–õ–¨–¢–ê–¢–û–í: 'AI',
  –õ–ò–°–¢_–î–ê–ù–ù–´–•: '–í—Å–µ',
  
  // –ö–æ–ª–æ–Ω–∫–∏ –Ω–∞ –ª–∏—Å—Ç–µ "–í—Å–µ"
  –ö–û–õ–û–ù–ö–ò: {
    –î–ê–¢–ê_–ü–õ–ê–¢–ï–ñ–ê: 2,    // B
    –ù–û–ú–ï–†_–ö–ê–†–¢–´: 3,     // C
    –°–£–ú–ú–ê_–ü–õ–ê–¢–ï–ñ–ê: 7,   // G
    –ö–ê–¢–ï–ì–û–†–ò–Ø: 10       // J
  },
  
  // –ü–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö (1 = –∑–∞–≥–æ–ª–æ–≤–∫–∏, 2 = –¥–∞–Ω–Ω—ã–µ)
  –ü–ï–†–í–ê–Ø_–°–¢–†–û–ö–ê_–î–ê–ù–ù–´–•: 2,
  
  // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤—ã–≤–æ–¥–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
  –†–ï–ó–£–õ–¨–¢–ê–¢_–°–¢–ê–†–¢_–°–¢–†–û–ö–ê: 2,
  –†–ï–ó–£–õ–¨–¢–ê–¢_–°–¢–ê–†–¢_–ö–û–õ–û–ù–ö–ê: 1,
  
  // –ì–æ–¥ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ (null = –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑ –¥–∞–Ω–Ω—ã—Ö)
  –ì–û–î: null,
  
  // –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –Ω–æ–º–µ—Ä–∞ –∫–∞—Ä—Ç
  –†–ê–ó–†–ï–®–ï–ù–ù–´–ï_–ö–ê–†–¢–´: ['*4963', '*5436', '*6058'],
  
  // –ù–∞–∑–≤–∞–Ω–∏—è –∫–∞—Ä—Ç
  –ù–ê–ó–í–ê–ù–ò–Ø_–ö–ê–†–¢: {
    '*4963': '',
    '*5436': '–ö—Ä–∞—Å–Ω—ã–π –∫–æ—à–µ–ª–µ–∫',
    '*6058': '–ó–µ–ª–µ–Ω—ã–π –∫–æ—à–µ–ª–µ–∫'
  }
};

// ============================================================================
// –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò
// ============================================================================

/**
 * –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ —è—á–µ–π–∫–∏ –≤ –¥–∞—Ç—É
 */
function –ø–æ–ª—É—á–∏—Ç—å–î–∞—Ç—É(–∑–Ω–∞—á–µ–Ω–∏–µ) {
  if (!–∑–Ω–∞—á–µ–Ω–∏–µ) return null;
  
  // –ï—Å–ª–∏ —ç—Ç–æ —É–∂–µ –æ–±—ä–µ–∫—Ç Date
  if (–∑–Ω–∞—á–µ–Ω–∏–µ instanceof Date) {
    return –∑–Ω–∞—á–µ–Ω–∏–µ;
  }
  
  // –ï—Å–ª–∏ —ç—Ç–æ —Å—Ç—Ä–æ–∫–∞, –ø—ã—Ç–∞–µ–º—Å—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å
  if (typeof –∑–Ω–∞—á–µ–Ω–∏–µ === 'string') {
    // –§–æ—Ä–º–∞—Ç DD.MM.YYYY
    var —á–∞—Å—Ç–∏ = –∑–Ω–∞—á–µ–Ω–∏–µ.split('.');
    if (—á–∞—Å—Ç–∏.length === 3) {
      return new Date(—á–∞—Å—Ç–∏[2], —á–∞—Å—Ç–∏[1] - 1, —á–∞—Å—Ç–∏[0]);
    }
    // –ü—Ä–æ–±—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ
    var –¥–∞—Ç–∞ = new Date(–∑–Ω–∞—á–µ–Ω–∏–µ);
    if (!isNaN(–¥–∞—Ç–∞.getTime())) {
      return –¥–∞—Ç–∞;
    }
  }
  
  return null;
}

/**
 * –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ —Å—É–º–º—ã –≤ —á–∏—Å–ª–æ
 * –£–±–∏—Ä–∞–µ—Ç —Ç–µ–∫—Å—Ç "RUB", –∑–∞–ø—è—Ç—ã–µ –∑–∞–º–µ–Ω—è–µ—Ç –Ω–∞ —Ç–æ—á–∫–∏
 */
function –ø–æ–ª—É—á–∏—Ç—å–°—É–º–º—É(–∑–Ω–∞—á–µ–Ω–∏–µ) {
  if (–∑–Ω–∞—á–µ–Ω–∏–µ === null || –∑–Ω–∞—á–µ–Ω–∏–µ === undefined || –∑–Ω–∞—á–µ–Ω–∏–µ === '') {
    return 0;
  }
  
  // –ï—Å–ª–∏ —ç—Ç–æ —É–∂–µ —á–∏—Å–ª–æ
  if (typeof –∑–Ω–∞—á–µ–Ω–∏–µ === 'number') {
    return –∑–Ω–∞—á–µ–Ω–∏–µ;
  }
  
  // –ï—Å–ª–∏ —ç—Ç–æ —Å—Ç—Ä–æ–∫–∞, –∏–∑–≤–ª–µ–∫–∞–µ–º —á–∏—Å–ª–æ
  var —Ç–µ–∫—Å—Ç = –∑–Ω–∞—á–µ–Ω–∏–µ.toString();
  // –£–±–∏—Ä–∞–µ–º –≤—Å–µ –∫—Ä–æ–º–µ —Ü–∏—Ñ—Ä, –º–∏–Ω—É—Å–∞ –∏ –∑–∞–ø—è—Ç–æ–π/—Ç–æ—á–∫–∏
  —Ç–µ–∫—Å—Ç = —Ç–µ–∫—Å—Ç.replace(/[^\d.,-]/g, '');
  // –ó–∞–º–µ–Ω—è–µ–º –∑–∞–ø—è—Ç—É—é –Ω–∞ —Ç–æ—á–∫—É
  —Ç–µ–∫—Å—Ç = —Ç–µ–∫—Å—Ç.replace(',', '.');
  
  var —Å—É–º–º–∞ = parseFloat(—Ç–µ–∫—Å—Ç);
  return isNaN(—Å—É–º–º–∞) ? 0 : —Å—É–º–º–∞;
}

/**
 * –ü–æ–ª—É—á–∞–µ—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ä—Ç—ã –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è (–£–ª—É—á—à–µ–Ω–∏–µ #3)
 */
function –ø–æ–ª—É—á–∏—Ç—å–ù–∞–∑–≤–∞–Ω–∏–µ–ö–∞—Ä—Ç—ã(–Ω–æ–º–µ—Ä–ö–∞—Ä—Ç—ã) {
  var –Ω–∞–∑–≤–∞–Ω–∏–µ = –ö–û–ù–§–ò–ì.–ù–ê–ó–í–ê–ù–ò–Ø_–ö–ê–†–¢[–Ω–æ–º–µ—Ä–ö–∞—Ä—Ç—ã] || '';
  if (–Ω–∞–∑–≤–∞–Ω–∏–µ) {
    return –Ω–æ–º–µ—Ä–ö–∞—Ä—Ç—ã + ' - ' + –Ω–∞–∑–≤–∞–Ω–∏–µ;
  }
  return –Ω–æ–º–µ—Ä–ö–∞—Ä—Ç—ã;
}

/**
 * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –º–∞—Å—Å–∏–≤ –º–µ—Å—è—Ü–µ–≤ –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –≥–æ–¥–∞ (–£–ª—É—á—à–µ–Ω–∏–µ #2: –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –º–µ—Å—è—Ü–µ–≤)
 */
function —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å–ú–µ—Å—è—Ü—ã(–≥–æ–¥) {
  var –º–µ—Å—è—Ü—ã = [];
  var –Ω–∞–∑–≤–∞–Ω–∏—è–ú–µ—Å—è—Ü–µ–≤ = [
    '–Ø–Ω–≤–∞—Ä—å', '–§–µ–≤—Ä–∞–ª—å', '–ú–∞—Ä—Ç', '–ê–ø—Ä–µ–ª—å', '–ú–∞–π', '–ò—é–Ω—å',
    '–ò—é–ª—å', '–ê–≤–≥—É—Å—Ç', '–°–µ–Ω—Ç—è–±—Ä—å', '–û–∫—Ç—è–±—Ä—å', '–ù–æ—è–±—Ä—å', '–î–µ–∫–∞–±—Ä—å'
  ];
  
  for (var –º–µ—Å—è—Ü = 0; –º–µ—Å—è—Ü < 12; –º–µ—Å—è—Ü++) {
    var –ø–µ—Ä–≤—ã–π–î–µ–Ω—å = new Date(–≥–æ–¥, –º–µ—Å—è—Ü, 1);
    var –ø–æ—Å–ª–µ–¥–Ω–∏–π–î–µ–Ω—å = new Date(–≥–æ–¥, –º–µ—Å—è—Ü + 1, 0); // 0 –¥–µ–Ω—å —Å–ª–µ–¥—É—é—â–µ–≥–æ –º–µ—Å—è—Ü–∞ = –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–Ω—å —Ç–µ–∫—É—â–µ–≥–æ
    
    var –¥–µ–Ω—å–ù–∞—á–∞–ª–∞ = ('0' + –ø–µ—Ä–≤—ã–π–î–µ–Ω—å.getDate()).slice(-2);
    var –¥–µ–Ω—å–ö–æ–Ω—Ü–∞ = ('0' + –ø–æ—Å–ª–µ–¥–Ω–∏–π–î–µ–Ω—å.getDate()).slice(-2);
    var –º–µ—Å—è—Ü–°—Ç—Ä–æ–∫–∞ = ('0' + (–º–µ—Å—è—Ü + 1)).slice(-2);
    
    –º–µ—Å—è—Ü—ã.push({
      –Ω–∞–∑–≤–∞–Ω–∏–µ: –Ω–∞–∑–≤–∞–Ω–∏—è–ú–µ—Å—è—Ü–µ–≤[–º–µ—Å—è—Ü] + ' ' + –≥–æ–¥,
      –Ω–∞—á–∞–ª–æ: –¥–µ–Ω—å–ù–∞—á–∞–ª–∞ + '.' + –º–µ—Å—è—Ü–°—Ç—Ä–æ–∫–∞ + '.' + –≥–æ–¥,
      –∫–æ–Ω–µ—Ü: –¥–µ–Ω—å–ö–æ–Ω—Ü–∞ + '.' + –º–µ—Å—è—Ü–°—Ç—Ä–æ–∫–∞ + '.' + –≥–æ–¥,
      –Ω–∞—á–∞–ª—å–Ω–∞—è–î–∞—Ç–∞: –ø–µ—Ä–≤—ã–π–î–µ–Ω—å,
      –∫–æ–Ω–µ—á–Ω–∞—è–î–∞—Ç–∞: –ø–æ—Å–ª–µ–¥–Ω–∏–π–î–µ–Ω—å
    });
  }
  
  return –º–µ—Å—è—Ü—ã;
}

/**
 * –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –≥–æ–¥ –∏–∑ –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–µ–∫—É—â–∏–π (–£–ª—É—á—à–µ–Ω–∏–µ #2)
 */
function –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å–ì–æ–¥(–¥–∞–Ω–Ω—ã–µ) {
  if (–ö–û–ù–§–ò–ì.–ì–û–î) {
    return –ö–û–ù–§–ò–ì.–ì–û–î;
  }
  
  var —Ç–µ–∫—É—â–∏–π–ì–æ–¥ = new Date().getFullYear();
  var –Ω–∞–π–¥–µ–Ω–Ω—ã–π–ì–æ–¥ = null;
  
  // –ò—â–µ–º –ø–µ—Ä–≤—ã–π –≥–æ–¥ –≤ –¥–∞–Ω–Ω—ã—Ö
  for (var i = 0; i < –¥–∞–Ω–Ω—ã–µ.length; i++) {
    if (–¥–∞–Ω–Ω—ã–µ[i].–¥–∞—Ç–∞) {
      var –≥–æ–¥ = –¥–∞–Ω–Ω—ã–µ[i].–¥–∞—Ç–∞.getFullYear();
      if (!–Ω–∞–π–¥–µ–Ω–Ω—ã–π–ì–æ–¥ || –≥–æ–¥ < –Ω–∞–π–¥–µ–Ω–Ω—ã–π–ì–æ–¥) {
        –Ω–∞–π–¥–µ–Ω–Ω—ã–π–ì–æ–¥ = –≥–æ–¥;
      }
    }
  }
  
  return –Ω–∞–π–¥–µ–Ω–Ω—ã–π–ì–æ–¥ || —Ç–µ–∫—É—â–∏–π–ì–æ–¥;
}

/**
 * –ß–∏—Ç–∞–µ—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —Å –ª–∏—Å—Ç–∞ –æ–¥–∏–Ω —Ä–∞–∑ (–£–ª—É—á—à–µ–Ω–∏–µ #1: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)
 */
function –ø—Ä–æ—á–∏—Ç–∞—Ç—å–í—Å–µ–î–∞–Ω–Ω—ã–µ(–ª–∏—Å—Ç, config) {
  try {
    var –≤—Å–µLastRow = –ª–∏—Å—Ç.getLastRow();
    if (–≤—Å–µLastRow < config.–ü–ï–†–í–ê–Ø_–°–¢–†–û–ö–ê_–î–ê–ù–ù–´–•) {
      Logger.log('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —á—Ç–µ–Ω–∏—è');
      return [];
    }
    
    var –¥–∞–Ω–Ω—ã–µ = [];
    var –∫–æ–ª–æ–Ω–∫–∏ = config.–ö–û–õ–û–ù–ö–ò;
    
    // –ß–∏—Ç–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –æ–¥–Ω–∏–º –±–∞—Ç—á–µ–º –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
    var –¥–∏–∞–ø–∞–∑–æ–Ω = –ª–∏—Å—Ç.getRange(config.–ü–ï–†–í–ê–Ø_–°–¢–†–û–ö–ê_–î–ê–ù–ù–´–•, 1, –≤—Å–µLastRow - config.–ü–ï–†–í–ê–Ø_–°–¢–†–û–ö–ê_–î–ê–ù–ù–´–• + 1, 10);
    var –∑–Ω–∞—á–µ–Ω–∏—è = –¥–∏–∞–ø–∞–∑–æ–Ω.getValues();
    
    for (var i = 0; i < –∑–Ω–∞—á–µ–Ω–∏—è.length; i++) {
      var —Å—Ç—Ä–æ–∫–∞ = –∑–Ω–∞—á–µ–Ω–∏—è[i];
      var –¥–∞—Ç–∞–ü–ª–∞—Ç–µ–∂–∞ = —Å—Ç—Ä–æ–∫–∞[–∫–æ–ª–æ–Ω–∫–∏.–î–ê–¢–ê_–ü–õ–ê–¢–ï–ñ–ê - 1];
      var –Ω–æ–º–µ—Ä–ö–∞—Ä—Ç—ã = —Å—Ç—Ä–æ–∫–∞[–∫–æ–ª–æ–Ω–∫–∏.–ù–û–ú–ï–†_–ö–ê–†–¢–´ - 1];
      var —Å—É–º–º–∞–ü–ª–∞—Ç–µ–∂–∞ = —Å—Ç—Ä–æ–∫–∞[–∫–æ–ª–æ–Ω–∫–∏.–°–£–ú–ú–ê_–ü–õ–ê–¢–ï–ñ–ê - 1];
      var –∫–∞—Ç–µ–≥–æ—Ä–∏—è = —Å—Ç—Ä–æ–∫–∞[–∫–æ–ª–æ–Ω–∫–∏.–ö–ê–¢–ï–ì–û–†–ò–Ø - 1];
      
      // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏
      if (!–¥–∞—Ç–∞–ü–ª–∞—Ç–µ–∂–∞ || !–Ω–æ–º–µ—Ä–ö–∞—Ä—Ç—ã || –Ω–æ–º–µ—Ä–ö–∞—Ä—Ç—ã === '' || !–∫–∞—Ç–µ–≥–æ—Ä–∏—è || –∫–∞—Ç–µ–≥–æ—Ä–∏—è === '') {
        continue;
      }
      
      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–∞—Ä—Ç—É
      var –Ω–∞–π–¥–µ–Ω–Ω–∞—è–ö–∞—Ä—Ç–∞ = –Ω–∞–π—Ç–∏–ö–∞—Ä—Ç—É(–Ω–æ–º–µ—Ä–ö–∞—Ä—Ç—ã, config.–†–ê–ó–†–ï–®–ï–ù–ù–´–ï_–ö–ê–†–¢–´);
      if (!–Ω–∞–π–¥–µ–Ω–Ω–∞—è–ö–∞—Ä—Ç–∞) {
        continue;
      }
      
      // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –¥–∞—Ç—É
      var –¥–∞—Ç–∞ = –ø–æ–ª—É—á–∏—Ç—å–î–∞—Ç—É(–¥–∞—Ç–∞–ü–ª–∞—Ç–µ–∂–∞);
      if (!–¥–∞—Ç–∞) {
        Logger.log('–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –¥–∞—Ç—É –≤ —Å—Ç—Ä–æ–∫–µ ' + (config.–ü–ï–†–í–ê–Ø_–°–¢–†–û–ö–ê_–î–ê–ù–ù–´–• + i) + ': ' + –¥–∞—Ç–∞–ü–ª–∞—Ç–µ–∂–∞);
        continue;
      }
      
      // –ü–æ–ª—É—á–∞–µ–º —Å—É–º–º—É
      var —Å—É–º–º–∞ = –ø–æ–ª—É—á–∏—Ç—å–°—É–º–º—É(—Å—É–º–º–∞–ü–ª–∞—Ç–µ–∂–∞);
      if (—Å—É–º–º–∞ === 0) {
        continue;
      }
      
      –¥–∞–Ω–Ω—ã–µ.push({
        –¥–∞—Ç–∞: –¥–∞—Ç–∞,
        –∫–∞—Ä—Ç–∞: –Ω–∞–π–¥–µ–Ω–Ω–∞—è–ö–∞—Ä—Ç–∞,
        –∫–∞—Ç–µ–≥–æ—Ä–∏—è: String(–∫–∞—Ç–µ–≥–æ—Ä–∏—è).trim(),
        —Å—É–º–º–∞: —Å—É–º–º–∞,
        –Ω–æ–º–µ—Ä–°—Ç—Ä–æ–∫–∏: config.–ü–ï–†–í–ê–Ø_–°–¢–†–û–ö–ê_–î–ê–ù–ù–´–• + i
      });
    }
    
    Logger.log('–ü—Ä–æ—á–∏—Ç–∞–Ω–æ ' + –¥–∞–Ω–Ω—ã–µ.length + ' —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π');
    return –¥–∞–Ω–Ω—ã–µ;
    
  } catch (error) {
    Logger.log('–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö: ' + error.toString());
    throw error;
  }
}

/**
 * –ì—Ä—É–ø–ø–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ –º–µ—Å—è—Ü–∞–º –∏ –∫–∞—Ä—Ç–∞–º (–£–ª—É—á—à–µ–Ω–∏–µ #1)
 * –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ: –¥–∞—Ç—ã –º–µ—Å—è—Ü–µ–≤ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
 */
function –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å–î–∞–Ω–Ω—ã–µ–ü–æ–ú–µ—Å—è—Ü–∞–º(–¥–∞–Ω–Ω—ã–µ, –º–µ—Å—è—Ü—ã, —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ–ö–∞—Ä—Ç—ã) {
  var —Ä–µ–∑—É–ª—å—Ç–∞—Ç = {};
  
  // –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –¥–∞—Ç—ã –º–µ—Å—è—Ü–µ–≤ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
  var –º–µ—Å—è—Ü—ã–°–î–∞—Ç–∞–º–∏ = [];
  for (var i = 0; i < –º–µ—Å—è—Ü—ã.length; i++) {
    var –º–µ—Å—è—Ü = –º–µ—Å—è—Ü—ã[i];
    var –Ω–∞—á–∞–ª—å–Ω–∞—è–î–∞—Ç–∞ = new Date(–º–µ—Å—è—Ü.–Ω–∞—á–∞–ª—å–Ω–∞—è–î–∞—Ç–∞);
    –Ω–∞—á–∞–ª—å–Ω–∞—è–î–∞—Ç–∞.setHours(0, 0, 0, 0);
    var –∫–æ–Ω–µ—á–Ω–∞—è–î–∞—Ç–∞ = new Date(–º–µ—Å—è—Ü.–∫–æ–Ω–µ—á–Ω–∞—è–î–∞—Ç–∞);
    –∫–æ–Ω–µ—á–Ω–∞—è–î–∞—Ç–∞.setHours(23, 59, 59, 999);
    
    –º–µ—Å—è—Ü—ã–°–î–∞—Ç–∞–º–∏.push({
      –Ω–∞–∑–≤–∞–Ω–∏–µ: –º–µ—Å—è—Ü.–Ω–∞–∑–≤–∞–Ω–∏–µ,
      –Ω–∞—á–∞–ª—å–Ω–∞—è–î–∞—Ç–∞: –Ω–∞—á–∞–ª—å–Ω–∞—è–î–∞—Ç–∞,
      –∫–æ–Ω–µ—á–Ω–∞—è–î–∞—Ç–∞: –∫–æ–Ω–µ—á–Ω–∞—è–î–∞—Ç–∞
    });
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è –º–µ—Å—è—Ü–∞
    —Ä–µ–∑—É–ª—å—Ç–∞—Ç[–º–µ—Å—è—Ü.–Ω–∞–∑–≤–∞–Ω–∏–µ] = {};
    for (var j = 0; j < —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ–ö–∞—Ä—Ç—ã.length; j++) {
      var –∫–∞—Ä—Ç–∞ = —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ–ö–∞—Ä—Ç—ã[j];
      —Ä–µ–∑—É–ª—å—Ç–∞—Ç[–º–µ—Å—è—Ü.–Ω–∞–∑–≤–∞–Ω–∏–µ][–∫–∞—Ä—Ç–∞] = {
        –æ–±—â–∞—è–°—É–º–º–∞: 0,
        –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: {}
      };
    }
  }
  
  // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ
  var –¥–∞—Ç–∞–í—Ä–µ–º—è = 0;
  for (var i = 0; i < –¥–∞–Ω–Ω—ã–µ.length; i++) {
    var —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è = –¥–∞–Ω–Ω—ã–µ[i];
    –¥–∞—Ç–∞–í—Ä–µ–º—è = —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è.–¥–∞—Ç–∞.getTime();
    
    // –ù–∞—Ö–æ–¥–∏–º –º–µ—Å—è—Ü
    for (var j = 0; j < –º–µ—Å—è—Ü—ã–°–î–∞—Ç–∞–º–∏.length; j++) {
      var –º–µ—Å—è—Ü = –º–µ—Å—è—Ü—ã–°–î–∞—Ç–∞–º–∏[j];
      
      if (–¥–∞—Ç–∞–í—Ä–µ–º—è >= –º–µ—Å—è—Ü.–Ω–∞—á–∞–ª—å–Ω–∞—è–î–∞—Ç–∞.getTime() && –¥–∞—Ç–∞–í—Ä–µ–º—è <= –º–µ—Å—è—Ü.–∫–æ–Ω–µ—á–Ω–∞—è–î–∞—Ç–∞.getTime()) {
        var –∫–ª—é—á–ú–µ—Å—è—Ü–∞ = –º–µ—Å—è—Ü.–Ω–∞–∑–≤–∞–Ω–∏–µ;
        var –∫–∞—Ä—Ç–∞ = —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è.–∫–∞—Ä—Ç–∞;
        var –∫–∞—Ç–µ–≥–æ—Ä–∏—è = —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è.–∫–∞—Ç–µ–≥–æ—Ä–∏—è;
        var —Å—É–º–º–∞ = —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è.—Å—É–º–º–∞;
        
        if (!—Ä–µ–∑—É–ª—å—Ç–∞—Ç[–∫–ª—é—á–ú–µ—Å—è—Ü–∞][–∫–∞—Ä—Ç–∞].–∫–∞—Ç–µ–≥–æ—Ä–∏–∏[–∫–∞—Ç–µ–≥–æ—Ä–∏—è]) {
          —Ä–µ–∑—É–ª—å—Ç–∞—Ç[–∫–ª—é—á–ú–µ—Å—è—Ü–∞][–∫–∞—Ä—Ç–∞].–∫–∞—Ç–µ–≥–æ—Ä–∏–∏[–∫–∞—Ç–µ–≥–æ—Ä–∏—è] = 0;
        }
        
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç[–∫–ª—é—á–ú–µ—Å—è—Ü–∞][–∫–∞—Ä—Ç–∞].–æ–±—â–∞—è–°—É–º–º–∞ += —Å—É–º–º–∞;
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç[–∫–ª—é—á–ú–µ—Å—è—Ü–∞][–∫–∞—Ä—Ç–∞].–∫–∞—Ç–µ–≥–æ—Ä–∏–∏[–∫–∞—Ç–µ–≥–æ—Ä–∏—è] += —Å—É–º–º–∞;
        break;
      }
    }
  }
  
  return —Ä–µ–∑—É–ª—å—Ç–∞—Ç;
}

/**
 * –ü—Ä–∏–º–µ–Ω—è–µ—Ç —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫ –¥–∏–∞–ø–∞–∑–æ–Ω—É —è—á–µ–µ–∫
 */
function –ø—Ä–∏–º–µ–Ω–∏—Ç—å–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ(range, —Å—Ç–∏–ª—å) {
  if (!—Å—Ç–∏–ª—å || typeof —Å—Ç–∏–ª—å !== 'object') return;
  
  if (—Å—Ç–∏–ª—å.fontWeight) range.setFontWeight(—Å—Ç–∏–ª—å.fontWeight);
  if (—Å—Ç–∏–ª—å.fontSize) range.setFontSize(—Å—Ç–∏–ª—å.fontSize);
  if (—Å—Ç–∏–ª—å.fontFamily) range.setFontFamily(—Å—Ç–∏–ª—å.fontFamily);
  if (—Å—Ç–∏–ª—å.fontColor) range.setFontColor(—Å—Ç–∏–ª—å.fontColor);
  if (—Å—Ç–∏–ª—å.backgroundColor) range.setBackground(—Å—Ç–∏–ª—å.backgroundColor);
  if (—Å—Ç–∏–ª—å.horizontalAlignment) range.setHorizontalAlignment(—Å—Ç–∏–ª—å.horizontalAlignment);
  if (—Å—Ç–∏–ª—å.verticalAlignment) range.setVerticalAlignment(—Å—Ç–∏–ª—å.verticalAlignment);
  if (—Å—Ç–∏–ª—å.border !== undefined && —Å—Ç–∏–ª—å.border) {
    range.setBorder(true, true, true, true, true, true, '#000000', SpreadsheetApp.BorderStyle.SOLID);
  }
}

/**
 * –ü–æ–ª—É—á–∞–µ—Ç –ª–∏—Å—Ç –ø–æ –∏–º–µ–Ω–∏ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
 */
function –ø–æ–ª—É—á–∏—Ç—å–õ–∏—Å—Ç(spreadsheet, –∏–º—è–õ–∏—Å—Ç–∞) {
  var –ª–∏—Å—Ç = spreadsheet.getSheetByName(–∏–º—è–õ–∏—Å—Ç–∞);
  if (!–ª–∏—Å—Ç) {
    var –æ—à–∏–±–∫–∞ = '–õ–∏—Å—Ç "' + –∏–º—è–õ–∏—Å—Ç–∞ + '" –Ω–µ –Ω–∞–π–¥–µ–Ω!';
    Logger.log('–û–®–ò–ë–ö–ê: ' + –æ—à–∏–±–∫–∞);
    throw new Error(–æ—à–∏–±–∫–∞);
  }
  return –ª–∏—Å—Ç;
}

/**
 * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ –æ–±—ä–µ–∫—Ç–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ –∫–∞—Ä—Ç–∞–º
 */
function –µ—Å—Ç—å–î–∞–Ω–Ω—ã–µ(–¥–∞–Ω–Ω—ã–µ–ü–æ–ö–∞—Ä—Ç–∞–º) {
  for (var –∫–∞—Ä—Ç–∞ in –¥–∞–Ω–Ω—ã–µ–ü–æ–ö–∞—Ä—Ç–∞–º) {
    if (–¥–∞–Ω–Ω—ã–µ–ü–æ–ö–∞—Ä—Ç–∞–º[–∫–∞—Ä—Ç–∞].–æ–±—â–∞—è–°—É–º–º–∞ !== 0) {
      return true;
    }
  }
  return false;
}

/**
 * –ù–∞—Ö–æ–¥–∏—Ç –Ω–æ–º–µ—Ä –∫–∞—Ä—Ç—ã –≤ —Å—Ç—Ä–æ–∫–µ –Ω–æ–º–µ—Ä–∞ –∫–∞—Ä—Ç—ã
 */
function –Ω–∞–π—Ç–∏–ö–∞—Ä—Ç—É(–Ω–æ–º–µ—Ä–ö–∞—Ä—Ç—ã, —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ–ö–∞—Ä—Ç—ã) {
  var –Ω–æ–º–µ—Ä–ö–∞—Ä—Ç—ã–°—Ç—Ä–æ–∫–∞ = String(–Ω–æ–º–µ—Ä–ö–∞—Ä—Ç—ã);
  for (var j = 0; j < —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ–ö–∞—Ä—Ç—ã.length; j++) {
    if (–Ω–æ–º–µ—Ä–ö–∞—Ä—Ç—ã–°—Ç—Ä–æ–∫–∞.endsWith(—Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ–ö–∞—Ä—Ç—ã[j])) {
      return —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ–ö–∞—Ä—Ç—ã[j];
    }
  }
  return null;
}

/**
 * –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Å—Ç—Ä–æ–∫–∏ —Ç–∞–±–ª–∏—Ü—ã —Å —á–µ—Ä–µ–¥—É—é—â–∏–º–∏—Å—è —Ü–≤–µ—Ç–∞–º–∏
 */
function –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å–°—Ç—Ä–æ–∫–∏–¢–∞–±–ª–∏—Ü—ã(–ª–∏—Å—Ç, –Ω–∞—á–∞–ª—å–Ω–∞—è–°—Ç—Ä–æ–∫–∞, –∫–æ–ª–æ–Ω–∫–∞, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–°—Ç—Ä–æ–∫, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–ö–æ–ª–æ–Ω–æ–∫, —Å—Ç–∏–ª–∏) {
  var —Ñ–æ—Ä–º–∞—Ç–ß–µ—Ç–Ω—ã—Ö = —Å—Ç–∏–ª–∏.—á–µ—Ç–Ω—ã–µ || {};
  var —Ñ–æ—Ä–º–∞—Ç–ù–µ—á–µ—Ç–Ω—ã—Ö = —Å—Ç–∏–ª–∏.–Ω–µ—á–µ—Ç–Ω—ã–µ || {};
  var –æ–±—â–∏–π–°—Ç–∏–ª—å = —Å—Ç–∏–ª–∏.–æ–±—â–∏–π || {};
  
  for (var i = 0; i < –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–°—Ç—Ä–æ–∫; i++) {
    var —Å—Ç—Ä–æ–∫–∞Range = –ª–∏—Å—Ç.getRange(–Ω–∞—á–∞–ª—å–Ω–∞—è–°—Ç—Ä–æ–∫–∞ + i, –∫–æ–ª–æ–Ω–∫–∞, 1, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–ö–æ–ª–æ–Ω–æ–∫);
    var —Å—Ç–∏–ª—å = (i % 2 === 0) ? —Ñ–æ—Ä–º–∞—Ç–ß–µ—Ç–Ω—ã—Ö : —Ñ–æ—Ä–º–∞—Ç–ù–µ—á–µ—Ç–Ω—ã—Ö;
    
    // –ü—Ä–∏–º–µ–Ω—è–µ–º –æ–±—â–∏–π —Å—Ç–∏–ª—å
    –ø—Ä–∏–º–µ–Ω–∏—Ç—å–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ(—Å—Ç—Ä–æ–∫–∞Range, –æ–±—â–∏–π–°—Ç–∏–ª—å);
    // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–π —Å—Ç–∏–ª—å (—á–µ—Ç–Ω—ã–π/–Ω–µ—á–µ—Ç–Ω—ã–π)
    –ø—Ä–∏–º–µ–Ω–∏—Ç—å–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ(—Å—Ç—Ä–æ–∫–∞Range, —Å—Ç–∏–ª—å);
  }
}

/**
 * –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ –º–µ—Å—è—Ü–∞
 */
function –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å–ó–∞–≥–æ–ª–æ–≤–æ–∫–ú–µ—Å—è—Ü–∞(–ª–∏—Å—Ç, —Å—Ç—Ä–æ–∫–∞, –∫–æ–ª–æ–Ω–∫–∞, —Ç–µ–∫—Å—Ç, —à–∏—Ä–∏–Ω–∞) {
  var –∑–∞–≥–æ–ª–æ–≤–æ–∫Range = –ª–∏—Å—Ç.getRange(—Å—Ç—Ä–æ–∫–∞, –∫–æ–ª–æ–Ω–∫–∞, 1, —à–∏—Ä–∏–Ω–∞);
  –∑–∞–≥–æ–ª–æ–≤–æ–∫Range.merge();
  var –∑–∞–≥–æ–ª–æ–≤–æ–∫–Ø—á–µ–π–∫–∞ = –ª–∏—Å—Ç.getRange(—Å—Ç—Ä–æ–∫–∞, –∫–æ–ª–æ–Ω–∫–∞);
  –∑–∞–≥–æ–ª–æ–≤–æ–∫–Ø—á–µ–π–∫–∞.setValue(—Ç–µ–∫—Å—Ç);
  –∑–∞–≥–æ–ª–æ–≤–æ–∫–Ø—á–µ–π–∫–∞.setFontWeight('bold');
  –∑–∞–≥–æ–ª–æ–≤–æ–∫–Ø—á–µ–π–∫–∞.setFontSize(16);
  –∑–∞–≥–æ–ª–æ–≤–æ–∫–Ø—á–µ–π–∫–∞.setFontFamily('Arial');
  –∑–∞–≥–æ–ª–æ–≤–æ–∫–Ø—á–µ–π–∫–∞.setHorizontalAlignment('center');
  –∑–∞–≥–æ–ª–æ–≤–æ–∫–Ø—á–µ–π–∫–∞.setBackground('#D9E1F2');
  –∑–∞–≥–æ–ª–æ–≤–æ–∫Range.setBorder(true, true, true, true, true, true, '#000000', SpreadsheetApp.BorderStyle.SOLID);
}

/**
 * –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Å—É–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º (–ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω–Ω–∞—è —Å —É–ª—É—á—à–µ–Ω–∏—è–º–∏)
 * –£–ª—É—á—à–µ–Ω–∏—è: #1 –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è, #2 –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –≥–æ–¥, #3 –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è, #4 –ë–∞—Ç—á–∏–Ω–≥, #5 –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
 */
function Test() {
  try {
    Logger.log('=== –ù–∞—á–∞–ª–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–∞ ===');
    
    var spreadsheet = SpreadsheetApp.getActiveSpreadsheet();
    
    // –ü–æ–ª—É—á–∞–µ–º –ª–∏—Å—Ç—ã (–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: –≤—ã–Ω–µ—Å–µ–Ω–æ –≤ —Ñ—É–Ω–∫—Ü–∏—é)
    var aiSheet;
    var –≤—Å–µSheet;
    try {
      aiSheet = –ø–æ–ª—É—á–∏—Ç—å–õ–∏—Å—Ç(spreadsheet, –ö–û–ù–§–ò–ì.–õ–ò–°–¢_–†–ï–ó–£–õ–¨–¢–ê–¢–û–í);
      –≤—Å–µSheet = –ø–æ–ª—É—á–∏—Ç—å–õ–∏—Å—Ç(spreadsheet, –ö–û–ù–§–ò–ì.–õ–ò–°–¢_–î–ê–ù–ù–´–•);
    } catch (error) {
      SpreadsheetApp.getUi().alert(error.message);
      return;
    }
    
    // –£–¥–∞–ª—è–µ–º –≤—Å–µ –¥–∏–∞–≥—Ä–∞–º–º—ã —Å –ª–∏—Å—Ç–∞ –ø–µ—Ä–µ–¥ –æ—á–∏—Å—Ç–∫–æ–π
    var –¥–∏–∞–≥—Ä–∞–º–º—ã = aiSheet.getCharts();
    for (var i = 0; i < –¥–∏–∞–≥—Ä–∞–º–º—ã.length; i++) {
      aiSheet.removeChart(–¥–∏–∞–≥—Ä–∞–º–º—ã[i]);
    }
    if (–¥–∏–∞–≥—Ä–∞–º–º—ã.length > 0) {
      Logger.log('–£–¥–∞–ª–µ–Ω–æ –¥–∏–∞–≥—Ä–∞–º–º: ' + –¥–∏–∞–≥—Ä–∞–º–º—ã.length);
    }
    
    // –û—á–∏—â–∞–µ–º –≤–µ—Å—å –ª–∏—Å—Ç "AI" (–≤–∫–ª—é—á–∞—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
    aiSheet.clear();
    Logger.log('–õ–∏—Å—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –æ—á–∏—â–µ–Ω');
    
    // –£–ª—É—á—à–µ–Ω–∏–µ #1: –ß–∏—Ç–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –æ–¥–∏–Ω —Ä–∞–∑
    Logger.log('–ß—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å –ª–∏—Å—Ç–∞ "' + –ö–û–ù–§–ò–ì.–õ–ò–°–¢_–î–ê–ù–ù–´–• + '"...');
    var –≤—Å–µ–î–∞–Ω–Ω—ã–µ = –ø—Ä–æ—á–∏—Ç–∞—Ç—å–í—Å–µ–î–∞–Ω–Ω—ã–µ(–≤—Å–µSheet, –ö–û–ù–§–ò–ì);
    
    if (–≤—Å–µ–î–∞–Ω–Ω—ã–µ.length === 0) {
      Logger.log('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏');
      SpreadsheetApp.getUi().alert('–ù–∞ –ª–∏—Å—Ç–µ "' + –ö–û–ù–§–ò–ì.–õ–ò–°–¢_–î–ê–ù–ù–´–• + '" –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏');
      return;
    }
    
    // –£–ª—É—á—à–µ–Ω–∏–µ #2: –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≥–æ–¥ –∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –º–µ—Å—è—Ü—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏
    var –≥–æ–¥ = –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å–ì–æ–¥(–≤—Å–µ–î–∞–Ω–Ω—ã–µ);
    Logger.log('–û–ø—Ä–µ–¥–µ–ª–µ–Ω –≥–æ–¥: ' + –≥–æ–¥);
    var –º–µ—Å—è—Ü—ã = —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å–ú–µ—Å—è—Ü—ã(–≥–æ–¥);
    Logger.log('–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ ' + –º–µ—Å—è—Ü—ã.length + ' –º–µ—Å—è—Ü–µ–≤');
    
    // –£–ª—É—á—à–µ–Ω–∏–µ #1: –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ –º–µ—Å—è—Ü–∞–º –æ–¥–∏–Ω —Ä–∞–∑
    Logger.log('–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ –º–µ—Å—è—Ü–∞–º...');
    var –¥–∞–Ω–Ω—ã–µ–ü–æ–ú–µ—Å—è—Ü–∞–º = –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å–î–∞–Ω–Ω—ã–µ–ü–æ–ú–µ—Å—è—Ü–∞–º(–≤—Å–µ–î–∞–Ω–Ω—ã–µ, –º–µ—Å—è—Ü—ã, –ö–û–ù–§–ò–ì.–†–ê–ó–†–ï–®–ï–ù–ù–´–ï_–ö–ê–†–¢–´);
    
    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤—ã–≤–æ–¥–∞
    var —Ä–µ–∑—É–ª—å—Ç–∞—ÇStartRow = –ö–û–ù–§–ò–ì.–†–ï–ó–£–õ–¨–¢–ê–¢_–°–¢–ê–†–¢_–°–¢–†–û–ö–ê;
    var —Ä–µ–∑—É–ª—å—Ç–∞—ÇStartCol = –ö–û–ù–§–ò–ì.–†–ï–ó–£–õ–¨–¢–ê–¢_–°–¢–ê–†–¢_–ö–û–õ–û–ù–ö–ê;
    var —Ç–µ–∫—É—â–∞—è–°—Ç—Ä–æ–∫–∞ = —Ä–µ–∑—É–ª—å—Ç–∞—ÇStartRow;
    
    // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞–∂–¥—ã–π –º–µ—Å—è—Ü
    for (var –º–µ—Å—è—ÜIdx = 0; –º–µ—Å—è—ÜIdx < –º–µ—Å—è—Ü—ã.length; –º–µ—Å—è—ÜIdx++) {
      var –º–µ—Å—è—Ü = –º–µ—Å—è—Ü—ã[–º–µ—Å—è—ÜIdx];
      var –¥–∞–Ω–Ω—ã–µ–ü–æ–ö–∞—Ä—Ç–∞–º = –¥–∞–Ω–Ω—ã–µ–ü–æ–ú–µ—Å—è—Ü–∞–º[–º–µ—Å—è—Ü.–Ω–∞–∑–≤–∞–Ω–∏–µ];
      
      if (!–¥–∞–Ω–Ω—ã–µ–ü–æ–ö–∞—Ä—Ç–∞–º) {
        continue;
      }
      
      // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –º–µ—Å—è—Ü, –µ—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞)
      if (!–µ—Å—Ç—å–î–∞–Ω–Ω—ã–µ(–¥–∞–Ω–Ω—ã–µ–ü–æ–ö–∞—Ä—Ç–∞–º)) {
        continue;
      }
      
      Logger.log('–û–±—Ä–∞–±–æ—Ç–∫–∞ –º–µ—Å—è—Ü–∞: ' + –º–µ—Å—è—Ü.–Ω–∞–∑–≤–∞–Ω–∏–µ);
      
      // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –º–µ—Å—è—Ü–∞ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ
      if (—Ç–µ–∫—É—â–∞—è–°—Ç—Ä–æ–∫–∞ > —Ä–µ–∑—É–ª—å—Ç–∞—ÇStartRow) {
        —Ç–µ–∫—É—â–∞—è–°—Ç—Ä–æ–∫–∞ += 2; // –ü—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –º–µ–∂–¥—É –º–µ—Å—è—Ü–∞–º–∏
      }
      
      –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å–ó–∞–≥–æ–ª–æ–≤–æ–∫–ú–µ—Å—è—Ü–∞(aiSheet, —Ç–µ–∫—É—â–∞—è–°—Ç—Ä–æ–∫–∞, —Ä–µ–∑—É–ª—å—Ç–∞—ÇStartCol, 'üìÖ ' + –º–µ—Å—è—Ü.–Ω–∞–∑–≤–∞–Ω–∏–µ, 3);
      —Ç–µ–∫—É—â–∞—è–°—Ç—Ä–æ–∫–∞ += 2;
      
      // –£–ª—É—á—à–µ–Ω–∏–µ #4: –ë–∞—Ç—á–∏–Ω–≥ - —Å–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã –æ–±—â–∏—Ö –∏—Ç–æ–≥–æ–≤
      var —Å—É–º–º—ã–ö–∞—Ä—Ç = [];
      var –æ–±—â–∞—è–°—É–º–º–∞–î–ª—è–ü—Ä–æ—Ü–µ–Ω—Ç–æ–≤ = 0; // –û–±—â–∞—è —Å—É–º–º–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è –∫–∞—Ä—Ç *5436 –∏ *6058
      var –ö–ê–†–¢–ê_–ò–°–ö–õ–Æ–ß–ï–ù–ê_–ò–ó_–ü–†–û–¶–ï–ù–¢–û–í = '*4963';
      
      // –°–Ω–∞—á–∞–ª–∞ –≤—ã—á–∏—Å–ª—è–µ–º —Å—É–º–º—ã –≤—Å–µ—Ö –∫–∞—Ä—Ç –∏ –æ–±—â—É—é —Å—É–º–º—É –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ (–±–µ–∑ –∫–∞—Ä—Ç—ã *4963)
      for (var i = 0; i < –ö–û–ù–§–ò–ì.–†–ê–ó–†–ï–®–ï–ù–ù–´–ï_–ö–ê–†–¢–´.length; i++) {
        var –∫–∞—Ä—Ç–∞ = –ö–û–ù–§–ò–ì.–†–ê–ó–†–ï–®–ï–ù–ù–´–ï_–ö–ê–†–¢–´[i];
        var –¥–∞–Ω–Ω—ã–µ = –¥–∞–Ω–Ω—ã–µ–ü–æ–ö–∞—Ä—Ç–∞–º[–∫–∞—Ä—Ç–∞];
        var —Å—É–º–º–∞ = Math.abs(–¥–∞–Ω–Ω—ã–µ.–æ–±—â–∞—è–°—É–º–º–∞);
        —Å—É–º–º—ã–ö–∞—Ä—Ç.push(—Å—É–º–º–∞);
        
        // –í –æ–±—â—É—é —Å—É–º–º—É –¥–ª—è –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ –≤–∫–ª—é—á–∞–µ–º —Ç–æ–ª—å–∫–æ –∫–∞—Ä—Ç—ã *5436 –∏ *6058
        if (–∫–∞—Ä—Ç–∞ !== –ö–ê–†–¢–ê_–ò–°–ö–õ–Æ–ß–ï–ù–ê_–ò–ó_–ü–†–û–¶–ï–ù–¢–û–í) {
          –æ–±—â–∞—è–°—É–º–º–∞–î–ª—è–ü—Ä–æ—Ü–µ–Ω—Ç–æ–≤ += —Å—É–º–º–∞;
        }
      }
      
      // –§–æ—Ä–º–∏—Ä—É–µ–º —Å—Ç—Ä–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Å –ø—Ä–æ—Ü–µ–Ω—Ç–∞–º–∏
      var —Å—Ç—Ä–æ–∫–∏–î–∞–Ω–Ω—ã—Ö = [];
      var –∏–Ω–¥–µ–∫—Å—ã–ö–∞—Ä—Ç–°–ü—Ä–æ—Ü–µ–Ω—Ç–∞–º–∏ = []; // –ò–Ω–¥–µ–∫—Å—ã –∫–∞—Ä—Ç, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å –ø—Ä–æ—Ü–µ–Ω—Ç—ã
      
      for (var i = 0; i < –ö–û–ù–§–ò–ì.–†–ê–ó–†–ï–®–ï–ù–ù–´–ï_–ö–ê–†–¢–´.length; i++) {
        var –∫–∞—Ä—Ç–∞ = –ö–û–ù–§–ò–ì.–†–ê–ó–†–ï–®–ï–ù–ù–´–ï_–ö–ê–†–¢–´[i];
        var –ø—Ä–æ—Ü–µ–Ω—Ç;
        
        // –î–ª—è –∫–∞—Ä—Ç—ã *4963 –ø—Ä–æ—Ü–µ–Ω—Ç –Ω–µ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º
        if (–∫–∞—Ä—Ç–∞ === –ö–ê–†–¢–ê_–ò–°–ö–õ–Æ–ß–ï–ù–ê_–ò–ó_–ü–†–û–¶–ï–ù–¢–û–í) {
          –ø—Ä–æ—Ü–µ–Ω—Ç = null; // null –≤–º–µ—Å—Ç–æ –ø—É—Å—Ç–æ–π —Å—Ç—Ä–æ–∫–∏
        } else {
          // –î–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –∫–∞—Ä—Ç –ø—Ä–æ—Ü–µ–Ω—Ç —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –æ—Ç —Å—É–º–º—ã —Ç–æ–ª—å–∫–æ –∫–∞—Ä—Ç *5436 –∏ *6058
          –ø—Ä–æ—Ü–µ–Ω—Ç = –æ–±—â–∞—è–°—É–º–º–∞–î–ª—è–ü—Ä–æ—Ü–µ–Ω—Ç–æ–≤ > 0 ? (—Å—É–º–º—ã–ö–∞—Ä—Ç[i] / –æ–±—â–∞—è–°—É–º–º–∞–î–ª—è–ü—Ä–æ—Ü–µ–Ω—Ç–æ–≤ * 100) : 0;
          –∏–Ω–¥–µ–∫—Å—ã–ö–∞—Ä—Ç–°–ü—Ä–æ—Ü–µ–Ω—Ç–∞–º–∏.push(i);
        }
        
        —Å—Ç—Ä–æ–∫–∏–î–∞–Ω–Ω—ã—Ö.push([–ø–æ–ª—É—á–∏—Ç—å–ù–∞–∑–≤–∞–Ω–∏–µ–ö–∞—Ä—Ç—ã(–∫–∞—Ä—Ç–∞), —Å—É–º–º—ã–ö–∞—Ä—Ç[i], –ø—Ä–æ—Ü–µ–Ω—Ç]);
      }
      
      // –£–ª—É—á—à–µ–Ω–∏–µ #4: –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ –±–∞—Ç—á–µ–º
      var –∑–∞–≥–æ–ª–æ–≤–∫–∏Range = aiSheet.getRange(—Ç–µ–∫—É—â–∞—è–°—Ç—Ä–æ–∫–∞, —Ä–µ–∑—É–ª—å—Ç–∞—ÇStartCol, 1, 3);
      –∑–∞–≥–æ–ª–æ–≤–∫–∏Range.setValues([['–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã', '–û–±—â–∞—è —Å—É–º–º–∞', '–ü—Ä–æ—Ü–µ–Ω—Ç']]);
      –ø—Ä–∏–º–µ–Ω–∏—Ç—å–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ(–∑–∞–≥–æ–ª–æ–≤–∫–∏Range, {
        fontWeight: 'bold',
        fontSize: 12,
        fontFamily: 'Arial',
        fontColor: '#FFFFFF',
        backgroundColor: '#4472C4',
        horizontalAlignment: 'center',
        verticalAlignment: 'middle',
        border: true
      });
      —Ç–µ–∫—É—â–∞—è–°—Ç—Ä–æ–∫–∞++;
      
      // –£–ª—É—á—à–µ–Ω–∏–µ #4: –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –±–∞—Ç—á–µ–º
      if (—Å—Ç—Ä–æ–∫–∏–î–∞–Ω–Ω—ã—Ö.length > 0) {
        var –¥–∞–Ω–Ω—ã–µRange = aiSheet.getRange(—Ç–µ–∫—É—â–∞—è–°—Ç—Ä–æ–∫–∞, —Ä–µ–∑—É–ª—å—Ç–∞—ÇStartCol, —Å—Ç—Ä–æ–∫–∏–î–∞–Ω–Ω—ã—Ö.length, 3);
        –¥–∞–Ω–Ω—ã–µRange.setValues(—Å—Ç—Ä–æ–∫–∏–î–∞–Ω–Ω—ã—Ö);
        
        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —á–∏—Å–ª–æ–≤—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –¥–ª—è –≤—Å–µ—Ö —Å—Ç—Ä–æ–∫
        var –¥–∏–∞–ø–∞–∑–æ–Ω–§–æ—Ä–º–∞—Ç = aiSheet.getRange(—Ç–µ–∫—É—â–∞—è–°—Ç—Ä–æ–∫–∞, —Ä–µ–∑—É–ª—å—Ç–∞—ÇStartCol + 1, —Å—Ç—Ä–æ–∫–∏–î–∞–Ω–Ω—ã—Ö.length, 1);
        –¥–∏–∞–ø–∞–∑–æ–Ω–§–æ—Ä–º–∞—Ç.setNumberFormat('#,##0.00" RUB"');
        
        // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–æ—Ä–º–∞—Ç –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ —Ç–æ–ª—å–∫–æ –∫ —è—á–µ–π–∫–∞–º —Å –¥–∞–Ω–Ω—ã–º–∏ (–Ω–µ null)
        for (var idx = 0; idx < –∏–Ω–¥–µ–∫—Å—ã–ö–∞—Ä—Ç–°–ü—Ä–æ—Ü–µ–Ω—Ç–∞–º–∏.length; idx++) {
          var —Å—Ç—Ä–æ–∫–∞Idx = –∏–Ω–¥–µ–∫—Å—ã–ö–∞—Ä—Ç–°–ü—Ä–æ—Ü–µ–Ω—Ç–∞–º–∏[idx];
          aiSheet.getRange(—Ç–µ–∫—É—â–∞—è–°—Ç—Ä–æ–∫–∞ + —Å—Ç—Ä–æ–∫–∞Idx, —Ä–µ–∑—É–ª—å—Ç–∞—ÇStartCol + 2).setNumberFormat('0.00"%"');
        }
        
        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–æ–∫ —Å —Ü–≤–µ—Ç–∞–º–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–∞—Ä—Ç—ã
        for (var i = 0; i < —Å—Ç—Ä–æ–∫–∏–î–∞–Ω–Ω—ã—Ö.length; i++) {
          var —Å—Ç—Ä–æ–∫–∞Range = aiSheet.getRange(—Ç–µ–∫—É—â–∞—è–°—Ç—Ä–æ–∫–∞ + i, —Ä–µ–∑—É–ª—å—Ç–∞—ÇStartCol, 1, 3);
          var –∫–∞—Ä—Ç–∞ = –ö–û–ù–§–ò–ì.–†–ê–ó–†–ï–®–ï–ù–ù–´–ï_–ö–ê–†–¢–´[i];
          var —Ü–≤–µ—Ç–§–æ–Ω–∞;
          
          // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ü–≤–µ—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–∞—Ä—Ç—ã
          if (–∫–∞—Ä—Ç–∞ === '*5436') {
            —Ü–≤–µ—Ç–§–æ–Ω–∞ = '#ff0000'; // –ö—Ä–∞—Å–Ω—ã–π –¥–ª—è "–ö—Ä–∞—Å–Ω—ã–π –∫–æ—à–µ–ª–µ–∫"
          } else if (–∫–∞—Ä—Ç–∞ === '*6058') {
            —Ü–≤–µ—Ç–§–æ–Ω–∞ = '#51CF66'; // –ó–µ–ª–µ–Ω—ã–π –¥–ª—è "–ó–µ–ª–µ–Ω—ã–π –∫–æ—à–µ–ª–µ–∫"
          } else {
            —Ü–≤–µ—Ç–§–æ–Ω–∞ = (i % 2 === 0) ? '#D9E1F2' : '#FFFFFF'; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —á–µ—Ä–µ–¥—É—é—â–∏–µ—Å—è —Ü–≤–µ—Ç–∞
          }
          
          –ø—Ä–∏–º–µ–Ω–∏—Ç—å–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ(—Å—Ç—Ä–æ–∫–∞Range, {
            fontFamily: 'Arial',
            fontSize: 11,
            backgroundColor: —Ü–≤–µ—Ç–§–æ–Ω–∞,
            border: true
          });
        }
        
        // –°–æ–∑–¥–∞–µ–º –∫—Ä—É–≥–æ–≤—É—é –¥–∏–∞–≥—Ä–∞–º–º—É —Å–ø—Ä–∞–≤–∞ –æ—Ç —Ç–∞–±–ª–∏—Ü—ã (–∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä—è–º–æ –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã)
        if (–∏–Ω–¥–µ–∫—Å—ã–ö–∞—Ä—Ç–°–ü—Ä–æ—Ü–µ–Ω—Ç–∞–º–∏.length > 0) {
          // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ü–≤–µ—Ç–∞ –¥–ª—è –¥–∏–∞–≥—Ä–∞–º–º—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–∞—Ä—Ç (–∫—Ä–∞—Å–Ω—ã–π –∏ –∑–µ–ª–µ–Ω—ã–π)
          var —Ü–≤–µ—Ç–∞–î–∏–∞–≥—Ä–∞–º–º—ã = [];
          for (var idx = 0; idx < –∏–Ω–¥–µ–∫—Å—ã–ö–∞—Ä—Ç–°–ü—Ä–æ—Ü–µ–Ω—Ç–∞–º–∏.length; idx++) {
            var —Å—Ç—Ä–æ–∫–∞Idx = –∏–Ω–¥–µ–∫—Å—ã–ö–∞—Ä—Ç–°–ü—Ä–æ—Ü–µ–Ω—Ç–∞–º–∏[idx];
            var –∫–∞—Ä—Ç–∞ = –ö–û–ù–§–ò–ì.–†–ê–ó–†–ï–®–ï–ù–ù–´–ï_–ö–ê–†–¢–´[—Å—Ç—Ä–æ–∫–∞Idx];
            if (–∫–∞—Ä—Ç–∞ === '*5436') {
              —Ü–≤–µ—Ç–∞–î–∏–∞–≥—Ä–∞–º–º—ã.push('#ff0000'); // –ö—Ä–∞—Å–Ω—ã–π –¥–ª—è "–ö—Ä–∞—Å–Ω—ã–π –∫–æ—à–µ–ª–µ–∫"
            } else if (–∫–∞—Ä—Ç–∞ === '*6058') {
              —Ü–≤–µ—Ç–∞–î–∏–∞–≥—Ä–∞–º–º—ã.push('#51CF66'); // –ó–µ–ª–µ–Ω—ã–π –¥–ª—è "–ó–µ–ª–µ–Ω—ã–π –∫–æ—à–µ–ª–µ–∫"
            } else {
              —Ü–≤–µ—Ç–∞–î–∏–∞–≥—Ä–∞–º–º—ã.push('#4472C4'); // –°–∏–Ω–∏–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            }
          }
          
          // –°–æ–∑–¥–∞–µ–º –∫—Ä—É–≥–æ–≤—É—é –¥–∏–∞–≥—Ä–∞–º–º—É, –∏—Å–ø–æ–ª—å–∑—É—è –¥–∞–Ω–Ω—ã–µ –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã
          // –ò–Ω–¥–µ–∫—Å—ã –∫–∞—Ä—Ç —Å –ø—Ä–æ—Ü–µ–Ω—Ç–∞–º–∏ –∏–¥—É—Ç –ø–æ–¥—Ä—è–¥ [1, 2]
          // —Ç–µ–∫—É—â–∞—è–°—Ç—Ä–æ–∫–∞ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø–µ—Ä–≤—É—é —Å—Ç—Ä–æ–∫—É –¥–∞–Ω–Ω—ã—Ö (–∫–∞—Ä—Ç–∞ *4963, –∏–Ω–¥–µ–∫—Å 0)
          // –ù—É–∂–Ω—ã —Å—Ç—Ä–æ–∫–∏ —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏ 1 –∏ 2 (–∫–∞—Ä—Ç—ã *5436 –∏ *6058)
          try {
            var –ø–µ—Ä–≤—ã–π–ò–Ω–¥–µ–∫—Å = –∏–Ω–¥–µ–∫—Å—ã–ö–∞—Ä—Ç–°–ü—Ä–æ—Ü–µ–Ω—Ç–∞–º–∏[0]; // –ò–Ω–¥–µ–∫—Å –ø–µ—Ä–≤–æ–π –∫–∞—Ä—Ç—ã —Å –ø—Ä–æ—Ü–µ–Ω—Ç–æ–º (1)
            var –ø–æ—Å–ª–µ–¥–Ω–∏–π–ò–Ω–¥–µ–∫—Å = –∏–Ω–¥–µ–∫—Å—ã–ö–∞—Ä—Ç–°–ü—Ä–æ—Ü–µ–Ω—Ç–∞–º–∏[–∏–Ω–¥–µ–∫—Å—ã–ö–∞—Ä—Ç–°–ü—Ä–æ—Ü–µ–Ω—Ç–∞–º–∏.length - 1]; // –ò–Ω–¥–µ–∫—Å –ø–æ—Å–ª–µ–¥–Ω–µ–π –∫–∞—Ä—Ç—ã —Å –ø—Ä–æ—Ü–µ–Ω—Ç–æ–º (2)
            
            // –°—Ç—Ä–æ–∫–∞ –ø–µ—Ä–≤–æ–π –∫–∞—Ä—Ç—ã —Å –ø—Ä–æ—Ü–µ–Ω—Ç–æ–º –≤ —Ç–∞–±–ª–∏—Ü–µ (—Ç–µ–∫—É—â–∞—è–°—Ç—Ä–æ–∫–∞ —É–∂–µ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –Ω–∞—á–∞–ª–æ –¥–∞–Ω–Ω—ã—Ö)
            var —Å—Ç—Ä–æ–∫–∞–ü–µ—Ä–≤–æ–π–ö–∞—Ä—Ç—ã = —Ç–µ–∫—É—â–∞—è–°—Ç—Ä–æ–∫–∞ + –ø–µ—Ä–≤—ã–π–ò–Ω–¥–µ–∫—Å;
            // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫ –¥–ª—è –¥–∏–∞–≥—Ä–∞–º–º—ã
            var –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–°—Ç—Ä–æ–∫ = –ø–æ—Å–ª–µ–¥–Ω–∏–π–ò–Ω–¥–µ–∫—Å - –ø–µ—Ä–≤—ã–π–ò–Ω–¥–µ–∫—Å + 1;
            
            // –í—ã—á–∏—Å–ª—è–µ–º —Å—Ç—Ä–æ–∫—É –∑–∞–≥–æ–ª–æ–≤–∫–∞ –¥–ª—è –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∏–∞–≥—Ä–∞–º–º—ã
            var —Å—Ç—Ä–æ–∫–∞–ó–∞–≥–æ–ª–æ–≤–∫–∞ = —Ç–µ–∫—É—â–∞—è–°—Ç—Ä–æ–∫–∞ - 1; // –°—Ç—Ä–æ–∫–∞ —Å –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏ —Ç–∞–±–ª–∏—Ü—ã
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ–¥–∏–Ω –¥–∏–∞–ø–∞–∑–æ–Ω –∏–∑ –¥–≤—É—Ö –∫–æ–ª–æ–Ω–æ–∫ (A –∏ B)
            // –î–ª—è pie chart Google Sheets –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –º–µ—Ç–∫–∏ –∏–∑ –ø–µ—Ä–≤–æ–π –∫–æ–ª–æ–Ω–∫–∏ –∏ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –≤—Ç–æ—Ä–æ–π
            var –¥–∏–∞–ø–∞–∑–æ–Ω–î–∏–∞–≥—Ä–∞–º–º—ã = aiSheet.getRange(—Å—Ç—Ä–æ–∫–∞–ü–µ—Ä–≤–æ–π–ö–∞—Ä—Ç—ã, —Ä–µ–∑—É–ª—å—Ç–∞—ÇStartCol, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–°—Ç—Ä–æ–∫, 2);
            
            Logger.log('–°–æ–∑–¥–∞–Ω–∏–µ –¥–∏–∞–≥—Ä–∞–º–º—ã –¥–ª—è –º–µ—Å—è—Ü–∞: ' + –º–µ—Å—è—Ü.–Ω–∞–∑–≤–∞–Ω–∏–µ + ', –¥–∏–∞–ø–∞–∑–æ–Ω: ' + –¥–∏–∞–ø–∞–∑–æ–Ω–î–∏–∞–≥—Ä–∞–º–º—ã.getA1Notation() + ', —Å—Ç—Ä–æ–∫–∞ –ø–µ—Ä–≤–æ–π –∫–∞—Ä—Ç—ã: ' + —Å—Ç—Ä–æ–∫–∞–ü–µ—Ä–≤–æ–π–ö–∞—Ä—Ç—ã + ', —Ç–µ–∫—É—â–∞—è–°—Ç—Ä–æ–∫–∞: ' + —Ç–µ–∫—É—â–∞—è–°—Ç—Ä–æ–∫–∞);
            
            try {
              var –¥–∏–∞–≥—Ä–∞–º–º–∞ = aiSheet.newChart()
                .setChartType(Charts.ChartType.PIE)
                .addRange(–¥–∏–∞–ø–∞–∑–æ–Ω–î–∏–∞–≥—Ä–∞–º–º—ã)
                .setPosition(—Å—Ç—Ä–æ–∫–∞–ó–∞–≥–æ–ª–æ–≤–∫–∞, —Ä–µ–∑—É–ª—å—Ç–∞—ÇStartCol + 4, 0, 0) // –†–∞–∑–º–µ—â–∞–µ–º —Å–ø—Ä–∞–≤–∞ –æ—Ç —Ç–∞–±–ª–∏—Ü—ã
                .setOption('title', '–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç—Ä–∞—Ç')
                .setOption('legend.position', 'right')
                .setOption('pieHole', 0)
                .setOption('is3D', false)
                .setOption('pieSliceText', 'percentage')
                .setOption('colors', —Ü–≤–µ—Ç–∞–î–∏–∞–≥—Ä–∞–º–º—ã)
                .setNumHeaders(0) // –ù–µ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ
                .build();
              
              aiSheet.insertChart(–¥–∏–∞–≥—Ä–∞–º–º–∞);
              Logger.log('–î–∏–∞–≥—Ä–∞–º–º–∞ —Å–æ–∑–¥–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ –¥–ª—è –º–µ—Å—è—Ü–∞: ' + –º–µ—Å—è—Ü.–Ω–∞–∑–≤–∞–Ω–∏–µ);
            } catch (chartError) {
              Logger.log('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –¥–∏–∞–≥—Ä–∞–º–º—ã –¥–ª—è –º–µ—Å—è—Ü–∞ ' + –º–µ—Å—è—Ü.–Ω–∞–∑–≤–∞–Ω–∏–µ + ': ' + chartError.toString());
            }
          } catch (error) {
            Logger.log('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –¥–∏–∞–≥—Ä–∞–º–º—ã: ' + error.toString());
          }
        }
        
        —Ç–µ–∫—É—â–∞—è–°—Ç—Ä–æ–∫–∞ += —Å—Ç—Ä–æ–∫–∏–î–∞–Ω–Ω—ã—Ö.length;
      }
  
      // –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ –ø–æ—Å–ª–µ —Ç–∞–±–ª–∏—Ü—ã –æ–±—â–∏—Ö –∏—Ç–æ–≥–æ–≤
      —Ç–µ–∫—É—â–∞—è–°—Ç—Ä–æ–∫–∞++;
      —Ç–µ–∫—É—â–∞—è–°—Ç—Ä–æ–∫–∞++;
      
      // 2. –í—ã–≤–æ–¥–∏–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –∫–∞—Ä—Ç—ã
      for (var i = 0; i < –ö–û–ù–§–ò–ì.–†–ê–ó–†–ï–®–ï–ù–ù–´–ï_–ö–ê–†–¢–´.length; i++) {
        var –∫–∞—Ä—Ç–∞ = –ö–û–ù–§–ò–ì.–†–ê–ó–†–ï–®–ï–ù–ù–´–ï_–ö–ê–†–¢–´[i];
        var –¥–∞–Ω–Ω—ã–µ = –¥–∞–Ω–Ω—ã–µ–ü–æ–ö–∞—Ä—Ç–∞–º[–∫–∞—Ä—Ç–∞];
        
        // –ü–æ–ª—É—á–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ —Å–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —Å—É–º–º–µ (–ø–æ —É–±—ã–≤–∞–Ω–∏—é)
        var –∫–∞—Ç–µ–≥–æ—Ä–∏–∏–ö–∞—Ä—Ç—ã = Object.keys(–¥–∞–Ω–Ω—ã–µ.–∫–∞—Ç–µ–≥–æ—Ä–∏–∏);
        if (–∫–∞—Ç–µ–≥–æ—Ä–∏–∏–ö–∞—Ä—Ç—ã.length > 0) {
          –∫–∞—Ç–µ–≥–æ—Ä–∏–∏–ö–∞—Ä—Ç—ã.sort(function(a, b) {
            return –¥–∞–Ω–Ω—ã–µ.–∫–∞—Ç–µ–≥–æ—Ä–∏–∏[b] - –¥–∞–Ω–Ω—ã–µ.–∫–∞—Ç–µ–≥–æ—Ä–∏–∏[a];
          });
          
          // –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è –∫–∞—Ä—Ç—ã
          var –∑–∞–≥–æ–ª–æ–≤–æ–∫–ö–∞—Ä—Ç—ãRange = aiSheet.getRange(—Ç–µ–∫—É—â–∞—è–°—Ç—Ä–æ–∫–∞, —Ä–µ–∑—É–ª—å—Ç–∞—ÇStartCol, 1, 2);
          –∑–∞–≥–æ–ª–æ–≤–æ–∫–ö–∞—Ä—Ç—ãRange.merge();
          aiSheet.getRange(—Ç–µ–∫—É—â–∞—è–°—Ç—Ä–æ–∫–∞, —Ä–µ–∑—É–ª—å—Ç–∞—ÇStartCol).setValue('üí≥ –ö–∞—Ä—Ç–∞: ' + –ø–æ–ª—É—á–∏—Ç—å–ù–∞–∑–≤–∞–Ω–∏–µ–ö–∞—Ä—Ç—ã(–∫–∞—Ä—Ç–∞));
          –ø—Ä–∏–º–µ–Ω–∏—Ç—å–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ(aiSheet.getRange(—Ç–µ–∫—É—â–∞—è–°—Ç—Ä–æ–∫–∞, —Ä–µ–∑—É–ª—å—Ç–∞—ÇStartCol), {
            fontWeight: 'bold',
            fontSize: 13,
            fontFamily: 'Arial',
            horizontalAlignment: 'center',
            backgroundColor: '#F2F2F2',
            border: true
          });
          —Ç–µ–∫—É—â–∞—è–°—Ç—Ä–æ–∫–∞++;
          
          // –£–ª—É—á—à–µ–Ω–∏–µ #4: –ó–∞–≥–æ–ª–æ–≤–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –±–∞—Ç—á–µ–º
          var –∑–∞–≥–æ–ª–æ–≤–∫–∏–ö–∞—Ç–µ–≥–æ—Ä–∏–πRange = aiSheet.getRange(—Ç–µ–∫—É—â–∞—è–°—Ç—Ä–æ–∫–∞, —Ä–µ–∑—É–ª—å—Ç–∞—ÇStartCol, 1, 2);
          –∑–∞–≥–æ–ª–æ–≤–∫–∏–ö–∞—Ç–µ–≥–æ—Ä–∏–πRange.setValues([['–ö–∞—Ç–µ–≥–æ—Ä–∏—è', '–°—É–º–º–∞']]);
          –ø—Ä–∏–º–µ–Ω–∏—Ç—å–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ(–∑–∞–≥–æ–ª–æ–≤–∫–∏–ö–∞—Ç–µ–≥–æ—Ä–∏–πRange, {
            fontWeight: 'bold',
            fontSize: 11,
            fontFamily: 'Arial',
            fontColor: '#000000',
            backgroundColor: '#FFC000',
            horizontalAlignment: 'center',
            verticalAlignment: 'middle',
            border: true
          });
          —Ç–µ–∫—É—â–∞—è–°—Ç—Ä–æ–∫–∞++;
          
          // –£–ª—É—á—à–µ–Ω–∏–µ #4: –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –¥–ª—è –±–∞—Ç—á–∞
          var –¥–∞–Ω–Ω—ã–µ–ö–∞—Ç–µ–≥–æ—Ä–∏–π = [];
          for (var j = 0; j < –∫–∞—Ç–µ–≥–æ—Ä–∏–∏–ö–∞—Ä—Ç—ã.length; j++) {
            var –∫–∞—Ç–µ–≥–æ—Ä–∏—è = –∫–∞—Ç–µ–≥–æ—Ä–∏–∏–ö–∞—Ä—Ç—ã[j];
            var —Å—É–º–º–∞ = Math.abs(–¥–∞–Ω–Ω—ã–µ.–∫–∞—Ç–µ–≥–æ—Ä–∏–∏[–∫–∞—Ç–µ–≥–æ—Ä–∏—è]);
            –¥–∞–Ω–Ω—ã–µ–ö–∞—Ç–µ–≥–æ—Ä–∏–π.push([–∫–∞—Ç–µ–≥–æ—Ä–∏—è, —Å—É–º–º–∞]);
          }
          
          // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –±–∞—Ç—á–µ–º
          if (–¥–∞–Ω–Ω—ã–µ–ö–∞—Ç–µ–≥–æ—Ä–∏–π.length > 0) {
            var –∫–∞—Ç–µ–≥–æ—Ä–∏–∏Range = aiSheet.getRange(—Ç–µ–∫—É—â–∞—è–°—Ç—Ä–æ–∫–∞, —Ä–µ–∑—É–ª—å—Ç–∞—ÇStartCol, –¥–∞–Ω–Ω—ã–µ–ö–∞—Ç–µ–≥–æ—Ä–∏–π.length, 2);
            –∫–∞—Ç–µ–≥–æ—Ä–∏–∏Range.setValues(–¥–∞–Ω–Ω—ã–µ–ö–∞—Ç–µ–≥–æ—Ä–∏–π);
            
            // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —á–∏—Å–ª–æ–≤—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –¥–ª—è –≤—Å–µ—Ö —Å—Ç—Ä–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
            var –¥–∏–∞–ø–∞–∑–æ–Ω–§–æ—Ä–º–∞—Ç–ö–∞—Ç–µ–≥–æ—Ä–∏–π = aiSheet.getRange(—Ç–µ–∫—É—â–∞—è–°—Ç—Ä–æ–∫–∞, —Ä–µ–∑—É–ª—å—Ç–∞—ÇStartCol + 1, –¥–∞–Ω–Ω—ã–µ–ö–∞—Ç–µ–≥–æ—Ä–∏–π.length, 1);
            –¥–∏–∞–ø–∞–∑–æ–Ω–§–æ—Ä–º–∞—Ç–ö–∞—Ç–µ–≥–æ—Ä–∏–π.setNumberFormat('#,##0.00" RUB"');
            
            // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–æ–∫ —Å —á–µ—Ä–µ–¥—É—é—â–∏–º–∏—Å—è —Ü–≤–µ—Ç–∞–º–∏
            –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å–°—Ç—Ä–æ–∫–∏–¢–∞–±–ª–∏—Ü—ã(aiSheet, —Ç–µ–∫—É—â–∞—è–°—Ç—Ä–æ–∫–∞, —Ä–µ–∑—É–ª—å—Ç–∞—ÇStartCol, –¥–∞–Ω–Ω—ã–µ–ö–∞—Ç–µ–≥–æ—Ä–∏–π.length, 2, {
              –æ–±—â–∏–π: { fontFamily: 'Arial', fontSize: 10, border: true },
              —á–µ—Ç–Ω—ã–µ: { backgroundColor: '#FFF2CC' },
              –Ω–µ—á–µ—Ç–Ω—ã–µ: { backgroundColor: '#FFE699' }
            });
            
            —Ç–µ–∫—É—â–∞—è–°—Ç—Ä–æ–∫–∞ += –¥–∞–Ω–Ω—ã–µ–ö–∞—Ç–µ–≥–æ—Ä–∏–π.length;
          }
          
          // –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ –ø–æ—Å–ª–µ —Ç–∞–±–ª–∏—Ü—ã –∫–∞—Ä—Ç—ã
          —Ç–µ–∫—É—â–∞—è–°—Ç—Ä–æ–∫–∞++;
        }
      }
    }
    
    // –ê–≤—Ç–æ–ø–æ–¥–±–æ—Ä —à–∏—Ä–∏–Ω—ã –∫–æ–ª–æ–Ω–æ–∫ (3 –∫–æ–ª–æ–Ω–∫–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã –∏—Ç–æ–≥–æ–≤)
    aiSheet.autoResizeColumns(—Ä–µ–∑—É–ª—å—Ç–∞—ÇStartCol, 3);
    
    Logger.log('=== –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–æ ===');
    SpreadsheetApp.getUi().alert('–°—É–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ –¥–ª—è –≤—Å–µ—Ö –º–µ—Å—è—Ü–µ–≤!');
    
  } catch (error) {
    // –£–ª—É—á—à–µ–Ω–∏–µ #5: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
    var —Å–æ–æ–±—â–µ–Ω–∏–µ = '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ —Å–∫—Ä–∏–ø—Ç–∞: ' + error.toString();
    Logger.log('–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: ' + —Å–æ–æ–±—â–µ–Ω–∏–µ);
    Logger.log('–°—Ç–µ–∫ –≤—ã–∑–æ–≤–æ–≤: ' + error.stack);
    SpreadsheetApp.getUi().alert(—Å–æ–æ–±—â–µ–Ω–∏–µ);
    throw error;
  }
}

/**
 * –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –º–µ–Ω—é –≤ Google Sheets
 */
function onOpen() {
  var ui = SpreadsheetApp.getUi();
  ui.createMenu('üìä –§–∏–Ω–∞–Ω—Å—ã')
    .addItem('–°—É–º–º–∏—Ä–æ–≤–∞—Ç—å –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º', 'Test')
    .addToUi();
  }
