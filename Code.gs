/**
 * –°–∫—Ä–∏–ø—Ç –¥–ª—è —Å—É–º–º–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
 * –°—á–∏—Ç—ã–≤–∞–µ—Ç –¥–∏–∞–ø–∞–∑–æ–Ω –¥–∞—Ç —Å –ª–∏—Å—Ç–∞ "AI" –∏ —Å—É–º–º–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ —Å –ª–∏—Å—Ç–∞ "–í—Å–µ"
 */

/**
 * –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ —è—á–µ–π–∫–∏ –≤ –¥–∞—Ç—É
 */
function –ø–æ–ª—É—á–∏—Ç—å–î–∞—Ç—É(–∑–Ω–∞—á–µ–Ω–∏–µ) {
  if (!–∑–Ω–∞—á–µ–Ω–∏–µ) return null;
  
  // –ï—Å–ª–∏ —ç—Ç–æ —É–∂–µ –æ–±—ä–µ–∫—Ç Date
  if (–∑–Ω–∞—á–µ–Ω–∏–µ instanceof Date) {
    return –∑–Ω–∞—á–µ–Ω–∏–µ;
  }
  
  // –ï—Å–ª–∏ —ç—Ç–æ —Å—Ç—Ä–æ–∫–∞, –ø—ã—Ç–∞–µ–º—Å—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å
  if (typeof –∑–Ω–∞—á–µ–Ω–∏–µ === 'string') {
    // –§–æ—Ä–º–∞—Ç DD.MM.YYYY
    var —á–∞—Å—Ç–∏ = –∑–Ω–∞—á–µ–Ω–∏–µ.split('.');
    if (—á–∞—Å—Ç–∏.length === 3) {
      return new Date(—á–∞—Å—Ç–∏[2], —á–∞—Å—Ç–∏[1] - 1, —á–∞—Å—Ç–∏[0]);
    }
    // –ü—Ä–æ–±—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ
    var –¥–∞—Ç–∞ = new Date(–∑–Ω–∞—á–µ–Ω–∏–µ);
    if (!isNaN(–¥–∞—Ç–∞.getTime())) {
      return –¥–∞—Ç–∞;
    }
  }
  
  return null;
}

/**
 * –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ —Å—É–º–º—ã –≤ —á–∏—Å–ª–æ
 * –£–±–∏—Ä–∞–µ—Ç —Ç–µ–∫—Å—Ç "RUB", –∑–∞–ø—è—Ç—ã–µ –∑–∞–º–µ–Ω—è–µ—Ç –Ω–∞ —Ç–æ—á–∫–∏
 */
function –ø–æ–ª—É—á–∏—Ç—å–°—É–º–º—É(–∑–Ω–∞—á–µ–Ω–∏–µ) {
  if (–∑–Ω–∞—á–µ–Ω–∏–µ === null || –∑–Ω–∞—á–µ–Ω–∏–µ === undefined || –∑–Ω–∞—á–µ–Ω–∏–µ === '') {
    return 0;
  }
  
  // –ï—Å–ª–∏ —ç—Ç–æ —É–∂–µ —á–∏—Å–ª–æ
  if (typeof –∑–Ω–∞—á–µ–Ω–∏–µ === 'number') {
    return –∑–Ω–∞—á–µ–Ω–∏–µ;
  }
  
  // –ï—Å–ª–∏ —ç—Ç–æ —Å—Ç—Ä–æ–∫–∞, –∏–∑–≤–ª–µ–∫–∞–µ–º —á–∏—Å–ª–æ
  var —Ç–µ–∫—Å—Ç = –∑–Ω–∞—á–µ–Ω–∏–µ.toString();
  // –£–±–∏—Ä–∞–µ–º –≤—Å–µ –∫—Ä–æ–º–µ —Ü–∏—Ñ—Ä, –º–∏–Ω—É—Å–∞ –∏ –∑–∞–ø—è—Ç–æ–π/—Ç–æ—á–∫–∏
  —Ç–µ–∫—Å—Ç = —Ç–µ–∫—Å—Ç.replace(/[^\d.,-]/g, '');
  // –ó–∞–º–µ–Ω—è–µ–º –∑–∞–ø—è—Ç—É—é –Ω–∞ —Ç–æ—á–∫—É
  —Ç–µ–∫—Å—Ç = —Ç–µ–∫—Å—Ç.replace(',', '.');
  
  var —Å—É–º–º–∞ = parseFloat(—Ç–µ–∫—Å—Ç);
  return isNaN(—Å—É–º–º–∞) ? 0 : —Å—É–º–º–∞;
}

/**
 * –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Å—É–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
 */
function Test() {
  var spreadsheet = SpreadsheetApp.getActiveSpreadsheet();
  
  // –ü–æ–ª—É—á–∞–µ–º –ª–∏—Å—Ç "AI"
  var aiSheet = spreadsheet.getSheetByName('AI');
  if (!aiSheet) {
    SpreadsheetApp.getUi().alert('–õ–∏—Å—Ç "AI" –Ω–µ –Ω–∞–π–¥–µ–Ω!');
    return;
  }
  
  // –ü–æ–ª—É—á–∞–µ–º –ª–∏—Å—Ç "–í—Å–µ"
  var –≤—Å–µSheet = spreadsheet.getSheetByName('–í—Å–µ');
  if (!–≤—Å–µSheet) {
    SpreadsheetApp.getUi().alert('–õ–∏—Å—Ç "–í—Å–µ" –Ω–µ –Ω–∞–π–¥–µ–Ω!');
    return;
  }
  
  // –ò—â–µ–º –Ω–∞—á–∞–ª—å–Ω—É—é –∏ –∫–æ–Ω–µ—á–Ω—É—é –¥–∞—Ç—ã –Ω–∞ –ª–∏—Å—Ç–µ "AI"
  // –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º, —á—Ç–æ –æ–Ω–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –≤ —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö, –∏—â–µ–º –ø–æ —Ç–µ–∫—Å—Ç—É
  var –Ω–∞—á–∞–ª—å–Ω–∞—è–î–∞—Ç–∞ = null;
  var –∫–æ–Ω–µ—á–Ω–∞—è–î–∞—Ç–∞ = null;
  var dataRange = aiSheet.getDataRange();
  var –∑–Ω–∞—á–µ–Ω–∏—è = dataRange.getValues();
  
  for (var i = 0; i < –∑–Ω–∞—á–µ–Ω–∏—è.length; i++) {
    for (var j = 0; j < –∑–Ω–∞—á–µ–Ω–∏—è[i].length; j++) {
      var —è—á–µ–π–∫–∞ = –∑–Ω–∞—á–µ–Ω–∏—è[i][j];
      if (typeof —è—á–µ–π–∫–∞ === 'string') {
        var –Ω–∏–∂–Ω–∏–π–†–µ–≥–∏—Å—Ç—Ä = —è—á–µ–π–∫–∞.toLowerCase().trim();
        if (–Ω–∏–∂–Ω–∏–π–†–µ–≥–∏—Å—Ç—Ä === '–Ω–∞—á–∞–ª—å–Ω–∞—è' || –Ω–∏–∂–Ω–∏–π–†–µ–≥–∏—Å—Ç—Ä === '–Ω–∞—á–∞–ª—å–Ω–∞—è –¥–∞—Ç–∞') {
          // –ë–µ—Ä–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ —Å–ø—Ä–∞–≤–∞ –∏–ª–∏ —Å–Ω–∏–∑—É
          if (j + 1 < –∑–Ω–∞—á–µ–Ω–∏—è[i].length) {
            –Ω–∞—á–∞–ª—å–Ω–∞—è–î–∞—Ç–∞ = –ø–æ–ª—É—á–∏—Ç—å–î–∞—Ç—É(–∑–Ω–∞—á–µ–Ω–∏—è[i][j + 1]);
          } else if (i + 1 < –∑–Ω–∞—á–µ–Ω–∏—è.length) {
            –Ω–∞—á–∞–ª—å–Ω–∞—è–î–∞—Ç–∞ = –ø–æ–ª—É—á–∏—Ç—å–î–∞—Ç—É(–∑–Ω–∞—á–µ–Ω–∏—è[i + 1][j]);
          }
        }
        if (–Ω–∏–∂–Ω–∏–π–†–µ–≥–∏—Å—Ç—Ä === '–∫–æ–Ω–µ—á–Ω–∞—è' || –Ω–∏–∂–Ω–∏–π–†–µ–≥–∏—Å—Ç—Ä === '–∫–æ–Ω–µ—á–Ω–∞—è –¥–∞—Ç–∞') {
          // –ë–µ—Ä–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ —Å–ø—Ä–∞–≤–∞ –∏–ª–∏ —Å–Ω–∏–∑—É
          if (j + 1 < –∑–Ω–∞—á–µ–Ω–∏—è[i].length) {
            –∫–æ–Ω–µ—á–Ω–∞—è–î–∞—Ç–∞ = –ø–æ–ª—É—á–∏—Ç—å–î–∞—Ç—É(–∑–Ω–∞—á–µ–Ω–∏—è[i][j + 1]);
          } else if (i + 1 < –∑–Ω–∞—á–µ–Ω–∏—è.length) {
            –∫–æ–Ω–µ—á–Ω–∞—è–î–∞—Ç–∞ = –ø–æ–ª—É—á–∏—Ç—å–î–∞—Ç—É(–∑–Ω–∞—á–µ–Ω–∏—è[i + 1][j]);
          }
        }
      }
    }
  }
  
  // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç: –µ—Å–ª–∏ –¥–∞—Ç—ã –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —è—á–µ–π–∫–∞—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, B1 –∏ B2)
  if (!–Ω–∞—á–∞–ª—å–Ω–∞—è–î–∞—Ç–∞) {
    –Ω–∞—á–∞–ª—å–Ω–∞—è–î–∞—Ç–∞ = –ø–æ–ª—É—á–∏—Ç—å–î–∞—Ç—É(aiSheet.getRange('B1').getValue());
  }
  if (!–∫–æ–Ω–µ—á–Ω–∞—è–î–∞—Ç–∞) {
    –∫–æ–Ω–µ—á–Ω–∞—è–î–∞—Ç–∞ = –ø–æ–ª—É—á–∏—Ç—å–î–∞—Ç—É(aiSheet.getRange('B2').getValue());
  }
  
  if (!–Ω–∞—á–∞–ª—å–Ω–∞—è–î–∞—Ç–∞ || !–∫–æ–Ω–µ—á–Ω–∞—è–î–∞—Ç–∞) {
    SpreadsheetApp.getUi().alert('–ù–µ –Ω–∞–π–¥–µ–Ω—ã –Ω–∞—á–∞–ª—å–Ω–∞—è –∏/–∏–ª–∏ –∫–æ–Ω–µ—á–Ω–∞—è –¥–∞—Ç—ã –Ω–∞ –ª–∏—Å—Ç–µ "AI"!\n–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥–∞—Ç—ã —É–∫–∞–∑–∞–Ω—ã —Ä—è–¥–æ–º —Å —Ç–µ–∫—Å—Ç–æ–º "–ù–∞—á–∞–ª—å–Ω–∞—è" –∏ "–ö–æ–Ω–µ—á–Ω–∞—è" –∏–ª–∏ –≤ —è—á–µ–π–∫–∞—Ö B1 –∏ B2.');
    return;
  }
  
  // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Ä–µ–º—è –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è (–Ω–∞—á–∞–ª–æ –∏ –∫–æ–Ω–µ—Ü –¥–Ω—è)
  –Ω–∞—á–∞–ª—å–Ω–∞—è–î–∞—Ç–∞.setHours(0, 0, 0, 0);
  –∫–æ–Ω–µ—á–Ω–∞—è–î–∞—Ç–∞.setHours(23, 59, 59, 999);
  
  // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å –ª–∏—Å—Ç–∞ "–í—Å–µ"
  var –≤—Å–µLastRow = –≤—Å–µSheet.getLastRow();
  if (–≤—Å–µLastRow < 1) {
    SpreadsheetApp.getUi().alert('–ù–∞ –ª–∏—Å—Ç–µ "–í—Å–µ" –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏');
    return;
  }
  
  // –ö–æ–ª–æ–Ω–∫–∏ –Ω–∞ –ª–∏—Å—Ç–µ "–í—Å–µ":
  // B (2) - –î–∞—Ç–∞ –ø–ª–∞—Ç–µ–∂–∞
  // C (3) - –ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã
  // G (7) - –°—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–∞
  // J (10) - –ö–∞—Ç–µ–≥–æ—Ä–∏—è
  
  var –¥–∞—Ç–∞–ü–ª–∞—Ç–µ–∂–∞Col = 2;  // B
  var –Ω–æ–º–µ—Ä–ö–∞—Ä—Ç—ãCol = 3;   // C
  var —Å—É–º–º–∞–ü–ª–∞—Ç–µ–∂–∞Col = 7;  // G
  var –∫–∞—Ç–µ–≥–æ—Ä–∏—èCol = 10;    // J
  
  // –°–ø–∏—Å–æ–∫ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö –Ω–æ–º–µ—Ä–æ–≤ –∫–∞—Ä—Ç
  var —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ–ö–∞—Ä—Ç—ã = ['*4963', '*5436', '*6058'];
  
  // –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö: –¥–∞–Ω–Ω—ã–µ–ü–æ–ö–∞—Ä—Ç–∞–º[–Ω–æ–º–µ—Ä–ö–∞—Ä—Ç—ã] = { –æ–±—â–∞—è–°—É–º–º–∞: —á–∏—Å–ª–æ, –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: { –∫–∞—Ç–µ–≥–æ—Ä–∏—è: —Å—É–º–º–∞ } }
  var –¥–∞–Ω–Ω—ã–µ–ü–æ–ö–∞—Ä—Ç–∞–º = {};
  
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∫–∞–∂–¥–æ–π —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω–æ–π –∫–∞—Ä—Ç—ã
  for (var i = 0; i < —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ–ö–∞—Ä—Ç—ã.length; i++) {
    –¥–∞–Ω–Ω—ã–µ–ü–æ–ö–∞—Ä—Ç–∞–º[—Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ–ö–∞—Ä—Ç—ã[i]] = {
      –æ–±—â–∞—è–°—É–º–º–∞: 0,
      –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: {}
    };
  }
  
  // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å—Ç—Ä–æ–∫–∏ –Ω–∞—á–∏–Ω–∞—è —Å –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–æ–∫–∏
  for (var row = 1; row <= –≤—Å–µLastRow; row++) {
    var –¥–∞—Ç–∞–ü–ª–∞—Ç–µ–∂–∞ = –≤—Å–µSheet.getRange(row, –¥–∞—Ç–∞–ü–ª–∞—Ç–µ–∂–∞Col).getValue();
    var –Ω–æ–º–µ—Ä–ö–∞—Ä—Ç—ã = –≤—Å–µSheet.getRange(row, –Ω–æ–º–µ—Ä–ö–∞—Ä—Ç—ãCol).getValue();
    var —Å—É–º–º–∞–ü–ª–∞—Ç–µ–∂–∞ = –≤—Å–µSheet.getRange(row, —Å—É–º–º–∞–ü–ª–∞—Ç–µ–∂–∞Col).getValue();
    var –∫–∞—Ç–µ–≥–æ—Ä–∏—è = –≤—Å–µSheet.getRange(row, –∫–∞—Ç–µ–≥–æ—Ä–∏—èCol).getValue();
    
    // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏
    if (!–¥–∞—Ç–∞–ü–ª–∞—Ç–µ–∂–∞ || !–Ω–æ–º–µ—Ä–ö–∞—Ä—Ç—ã || –Ω–æ–º–µ—Ä–ö–∞—Ä—Ç—ã === '' || !–∫–∞—Ç–µ–≥–æ—Ä–∏—è || –∫–∞—Ç–µ–≥–æ—Ä–∏—è === '') {
      continue;
    }
    
    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –∫–∞–∫–∞—è —ç—Ç–æ –∫–∞—Ä—Ç–∞ (–∏—â–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–π —Å—É—Ñ—Ñ–∏–∫—Å)
    var –Ω–∞–π–¥–µ–Ω–Ω–∞—è–ö–∞—Ä—Ç–∞ = null;
    for (var i = 0; i < —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ–ö–∞—Ä—Ç—ã.length; i++) {
      if (–Ω–æ–º–µ—Ä–ö–∞—Ä—Ç—ã.toString().endsWith(—Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ–ö–∞—Ä—Ç—ã[i])) {
        –Ω–∞–π–¥–µ–Ω–Ω–∞—è–ö–∞—Ä—Ç–∞ = —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ–ö–∞—Ä—Ç—ã[i];
        break;
      }
    }
    
    // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å—Ç—Ä–æ–∫–∏ —Å –Ω–µ—Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–º–∏ –∫–∞—Ä—Ç–∞–º–∏
    if (!–Ω–∞–π–¥–µ–Ω–Ω–∞—è–ö–∞—Ä—Ç–∞) {
      continue;
    }
    
    // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –¥–∞—Ç—É
    var –¥–∞—Ç–∞ = –ø–æ–ª—É—á–∏—Ç—å–î–∞—Ç—É(–¥–∞—Ç–∞–ü–ª–∞—Ç–µ–∂–∞);
    if (!–¥–∞—Ç–∞) {
      continue;
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –¥–∞—Ç–∞ –≤ –Ω—É–∂–Ω–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ
    if (–¥–∞—Ç–∞ < –Ω–∞—á–∞–ª—å–Ω–∞—è–î–∞—Ç–∞ || –¥–∞—Ç–∞ > –∫–æ–Ω–µ—á–Ω–∞—è–î–∞—Ç–∞) {
      continue;
    }
    
    // –ü–æ–ª—É—á–∞–µ–º —Å—É–º–º—É
    var —Å—É–º–º–∞ = –ø–æ–ª—É—á–∏—Ç—å–°—É–º–º—É(—Å—É–º–º–∞–ü–ª–∞—Ç–µ–∂–∞);
    if (—Å—É–º–º–∞ === 0) {
      continue;
    }
    
    // –î–æ–±–∞–≤–ª—è–µ–º –∫ –æ–±—â–µ–π —Å—É–º–º–µ –∫–∞—Ä—Ç—ã
    –¥–∞–Ω–Ω—ã–µ–ü–æ–ö–∞—Ä—Ç–∞–º[–Ω–∞–π–¥–µ–Ω–Ω–∞—è–ö–∞—Ä—Ç–∞].–æ–±—â–∞—è–°—É–º–º–∞ += —Å—É–º–º–∞;
    
    // –î–æ–±–∞–≤–ª—è–µ–º –∫ —Å—É–º–º–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è —ç—Ç–æ–π –∫–∞—Ä—Ç—ã
    if (!–¥–∞–Ω–Ω—ã–µ–ü–æ–ö–∞—Ä—Ç–∞–º[–Ω–∞–π–¥–µ–Ω–Ω–∞—è–ö–∞—Ä—Ç–∞].–∫–∞—Ç–µ–≥–æ—Ä–∏–∏[–∫–∞—Ç–µ–≥–æ—Ä–∏—è]) {
      –¥–∞–Ω–Ω—ã–µ–ü–æ–ö–∞—Ä—Ç–∞–º[–Ω–∞–π–¥–µ–Ω–Ω–∞—è–ö–∞—Ä—Ç–∞].–∫–∞—Ç–µ–≥–æ—Ä–∏–∏[–∫–∞—Ç–µ–≥–æ—Ä–∏—è] = 0;
    }
    –¥–∞–Ω–Ω—ã–µ–ü–æ–ö–∞—Ä—Ç–∞–º[–Ω–∞–π–¥–µ–Ω–Ω–∞—è–ö–∞—Ä—Ç–∞].–∫–∞—Ç–µ–≥–æ—Ä–∏–∏[–∫–∞—Ç–µ–≥–æ—Ä–∏—è] += —Å—É–º–º–∞;
  }
  
  // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –∫—É–¥–∞ –≤—ã–≤–æ–¥–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
  var —Ä–µ–∑—É–ª—å—Ç–∞—ÇStartRow = 4; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–∞—á–∏–Ω–∞–µ–º —Å 4 —Å—Ç—Ä–æ–∫–∏
  var —Ä–µ–∑—É–ª—å—Ç–∞—ÇStartCol = 1; // –ö–æ–ª–æ–Ω–∫–∞ A
  
  // –ò—â–µ–º –º–µ—Å—Ç–æ –¥–ª—è –≤—ã–≤–æ–¥–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
  var aiValues = aiSheet.getDataRange().getValues();
  for (var i = 0; i < aiValues.length; i++) {
    for (var j = 0; j < aiValues[i].length; j++) {
      if (typeof aiValues[i][j] === 'string' && 
          (aiValues[i][j].toLowerCase().indexOf('–∫–∞—Ç–µ–≥–æ—Ä–∏—è') !== -1 || 
           aiValues[i][j].toLowerCase().indexOf('–∏—Ç–æ–≥–æ') !== -1 ||
           aiValues[i][j].toLowerCase().indexOf('–∫–∞—Ä—Ç–∞') !== -1)) {
        —Ä–µ–∑—É–ª—å—Ç–∞—ÇStartRow = i + 2; // –ù–∞—á–∏–Ω–∞–µ–º —Å–æ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä–æ–∫–∏
        —Ä–µ–∑—É–ª—å—Ç–∞—ÇStartCol = j + 1;
        break;
      }
    }
    if (—Ä–µ–∑—É–ª—å—Ç–∞—ÇStartRow > 4) break;
  }
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –¥–∞–Ω–Ω—ã–µ
  var –µ—Å—Ç—å–î–∞–Ω–Ω—ã–µ = false;
  for (var –∫–∞—Ä—Ç–∞ in –¥–∞–Ω–Ω—ã–µ–ü–æ–ö–∞—Ä—Ç–∞–º) {
    if (–¥–∞–Ω–Ω—ã–µ–ü–æ–ö–∞—Ä—Ç–∞–º[–∫–∞—Ä—Ç–∞].–æ–±—â–∞—è–°—É–º–º–∞ !== 0) {
      –µ—Å—Ç—å–î–∞–Ω–Ω—ã–µ = true;
      break;
    }
  }
  
  if (!–µ—Å—Ç—å–î–∞–Ω–Ω—ã–µ) {
    SpreadsheetApp.getUi().alert('–ù–µ –Ω–∞–π–¥–µ–Ω–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∑–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥!');
    return;
  }
  
  // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (–æ—á–∏—â–∞–µ–º 500 —Å—Ç—Ä–æ–∫, 2 –∫–æ–ª–æ–Ω–∫–∏)
  aiSheet.getRange(—Ä–µ–∑—É–ª—å—Ç–∞—ÇStartRow, —Ä–µ–∑—É–ª—å—Ç–∞—ÇStartCol, 500, 2).clearContent();
  
  // –§–æ—Ä–º–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤—ã–≤–æ–¥–∞
  var –¥–∞–Ω–Ω—ã–µ–î–ª—è–í—ã–≤–æ–¥–∞ = [];
  var —Ç–µ–∫—É—â–∞—è–°—Ç—Ä–æ–∫–∞ = 0;
  
  // 1. –í—ã–≤–æ–¥–∏–º –æ–±—â–∏–µ —Å—É–º–º—ã –ø–æ –∫–∞—Ä—Ç–∞–º
  –¥–∞–Ω–Ω—ã–µ–î–ª—è–í—ã–≤–æ–¥–∞.push(['–û–±—â–∏–µ —Å—É–º–º—ã –ø–æ –∫–∞—Ä—Ç–∞–º', '']);
  —Ç–µ–∫—É—â–∞—è–°—Ç—Ä–æ–∫–∞++;
  
  for (var i = 0; i < —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ–ö–∞—Ä—Ç—ã.length; i++) {
    var –∫–∞—Ä—Ç–∞ = —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ–ö–∞—Ä—Ç—ã[i];
    var –¥–∞–Ω–Ω—ã–µ = –¥–∞–Ω–Ω—ã–µ–ü–æ–ö–∞—Ä—Ç–∞–º[–∫–∞—Ä—Ç–∞];
    –¥–∞–Ω–Ω—ã–µ–î–ª—è–í—ã–≤–æ–¥–∞.push([–∫–∞—Ä—Ç–∞, –¥–∞–Ω–Ω—ã–µ.–æ–±—â–∞—è–°—É–º–º–∞]);
    —Ç–µ–∫—É—â–∞—è–°—Ç—Ä–æ–∫–∞++;
  }
  
  // –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É
  –¥–∞–Ω–Ω—ã–µ–î–ª—è–í—ã–≤–æ–¥–∞.push(['', '']);
  —Ç–µ–∫—É—â–∞—è–°—Ç—Ä–æ–∫–∞++;
  
  // 2. –í—ã–≤–æ–¥–∏–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –∫–∞—Ä—Ç—ã
  for (var i = 0; i < —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ–ö–∞—Ä—Ç—ã.length; i++) {
    var –∫–∞—Ä—Ç–∞ = —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ–ö–∞—Ä—Ç—ã[i];
    var –¥–∞–Ω–Ω—ã–µ = –¥–∞–Ω–Ω—ã–µ–ü–æ–ö–∞—Ä—Ç–∞–º[–∫–∞—Ä—Ç–∞];
    
    // –ü–æ–ª—É—á–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ —Å–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —Å—É–º–º–µ (–ø–æ —É–±—ã–≤–∞–Ω–∏—é)
    var –∫–∞—Ç–µ–≥–æ—Ä–∏–∏–ö–∞—Ä—Ç—ã = Object.keys(–¥–∞–Ω–Ω—ã–µ.–∫–∞—Ç–µ–≥–æ—Ä–∏–∏);
    if (–∫–∞—Ç–µ–≥–æ—Ä–∏–∏–ö–∞—Ä—Ç—ã.length > 0) {
      –∫–∞—Ç–µ–≥–æ—Ä–∏–∏–ö–∞—Ä—Ç—ã.sort(function(a, b) {
        return –¥–∞–Ω–Ω—ã–µ.–∫–∞—Ç–µ–≥–æ—Ä–∏–∏[b] - –¥–∞–Ω–Ω—ã–µ.–∫–∞—Ç–µ–≥–æ—Ä–∏–∏[a];
      });
      
      // –ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è –∫–∞—Ä—Ç—ã
      –¥–∞–Ω–Ω—ã–µ–î–ª—è–í—ã–≤–æ–¥–∞.push([–∫–∞—Ä—Ç–∞ + ' - –∫–∞—Ç–µ–≥–æ—Ä–∏–∏', '']);
      —Ç–µ–∫—É—â–∞—è–°—Ç—Ä–æ–∫–∞++;
      
      // –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å —Å—É–º–º–∞–º–∏
      for (var j = 0; j < –∫–∞—Ç–µ–≥–æ—Ä–∏–∏–ö–∞—Ä—Ç—ã.length; j++) {
        var –∫–∞—Ç–µ–≥–æ—Ä–∏—è = –∫–∞—Ç–µ–≥–æ—Ä–∏–∏–ö–∞—Ä—Ç—ã[j];
        var —Å—É–º–º–∞ = –¥–∞–Ω–Ω—ã–µ.–∫–∞—Ç–µ–≥–æ—Ä–∏–∏[–∫–∞—Ç–µ–≥–æ—Ä–∏—è];
        –¥–∞–Ω–Ω—ã–µ–î–ª—è–í—ã–≤–æ–¥–∞.push([–∫–∞—Ç–µ–≥–æ—Ä–∏—è, —Å—É–º–º–∞]);
        —Ç–µ–∫—É—â–∞—è–°—Ç—Ä–æ–∫–∞++;
      }
      
      // –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É –º–µ–∂–¥—É –∫–∞—Ä—Ç–∞–º–∏
      –¥–∞–Ω–Ω—ã–µ–î–ª—è–í—ã–≤–æ–¥–∞.push(['', '']);
      —Ç–µ–∫—É—â–∞—è–°—Ç—Ä–æ–∫–∞++;
    }
  }
  
  // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
  var range = aiSheet.getRange(—Ä–µ–∑—É–ª—å—Ç–∞—ÇStartRow, —Ä–µ–∑—É–ª—å—Ç–∞—ÇStartCol, –¥–∞–Ω–Ω—ã–µ–î–ª—è–í—ã–≤–æ–¥–∞.length, 2);
  range.setValues(–¥–∞–Ω–Ω—ã–µ–î–ª—è–í—ã–≤–æ–¥–∞);
  
  // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –∫–æ–ª–æ–Ω–∫—É —Å —Å—É–º–º–∞–º–∏
  var —Å—É–º–º–∞Col = —Ä–µ–∑—É–ª—å—Ç–∞—ÇStartCol + 1;
  var —Å—É–º–º–∞Range = aiSheet.getRange(—Ä–µ–∑—É–ª—å—Ç–∞—ÇStartRow, —Å—É–º–º–∞Col, –¥–∞–Ω–Ω—ã–µ–î–ª—è–í—ã–≤–æ–¥–∞.length, 1);
  —Å—É–º–º–∞Range.setNumberFormat('#,##0.00" RUB"');
  
  SpreadsheetApp.getUi().alert('–°—É–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!');
}

/**
 * –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –º–µ–Ω—é –≤ Google Sheets
 */
function onOpen() {
  var ui = SpreadsheetApp.getUi();
  ui.createMenu('üìä –§–∏–Ω–∞–Ω—Å—ã')
    .addItem('–°—É–º–º–∏—Ä–æ–≤–∞—Ç—å –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º', 'Test')
    .addToUi();
}
